<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Content Security Policy: Embedded Enforcement</title>
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 4d0641293, updated Tue Mar 16 15:42:04 2021 -0700" name="generator">
  <link href="https://www.w3.org/TR/csp-embedded-enforcement/" rel="canonical">
  <meta content="3e2e1c59c8fb95de770ee6c8aa7a771e026e1c95" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-mdn-anno */

            @media (max-width: 767px) { .mdn-anno { opacity: .1 } }
            .mdn-anno { font: 1em sans-serif; padding: 0.3em; position: absolute; z-index: 8; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; border-collapse: initial; border-spacing: initial; min-width: 9em; max-width: min-content; white-space: nowrap; word-wrap: normal; hyphens: none}
            .mdn-anno:not(.wrapped) { opacity: 1}
            .mdn-anno:hover { z-index: 9 }
            .mdn-anno.wrapped { min-width: 0 }
            .mdn-anno.wrapped > :not(button) { display: none; }
            .mdn-anno > .mdn-anno-btn { cursor: pointer; border: none; color: #000; background: transparent; margin: -8px; float: right; padding: 10px 8px 8px 8px; outline: none; }
            .mdn-anno > .mdn-anno-btn > .less-than-two-engines-flag { color: red; padding-right: 2px; }
            .mdn-anno > .mdn-anno-btn > .all-engines-flag { color: green; padding-right: 2px; }
            .mdn-anno > .mdn-anno-btn > span { color: #fff; background-color: #000; font-weight: normal; font-family: zillaslab, Palatino, "Palatino Linotype", serif; padding: 2px 3px 0px 3px; line-height: 1.3em; vertical-align: top; }
            .mdn-anno > .feature { margin-top: 20px; }
            .mdn-anno > .feature:not(:first-of-type) { border-top: 1px solid #999; margin-top: 6px; padding-top: 2px; }
            .mdn-anno > .feature > .less-than-two-engines-text { color: red }
            .mdn-anno > .feature > .all-engines-text { color: green }
            .mdn-anno > .feature > p { font-size: .75em; margin-top: 6px; margin-bottom: 0; }
            .mdn-anno > .feature > p + p { margin-top: 3px; }
            .mdn-anno > .feature > .support { display: block; font-size: 0.6em; margin: 0; padding: 0; margin-top: 2px }
            .mdn-anno > .feature > .support + div { padding-top: 0.5em; }
            .mdn-anno > .feature > .support > hr { display: block; border: none; border-top: 1px dotted #999; padding: 3px 0px 0px 0px; margin: 2px 3px 0px 3px; }
            .mdn-anno > .feature > .support > hr::before { content: ""; }
            .mdn-anno > .feature > .support > span { padding: 0.2em 0; display: block; display: table; }
            .mdn-anno > .feature > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
            .mdn-anno > .feature > .support > span.no::before { opacity: 0.5; }
            .mdn-anno > .feature > .support > span:first-of-type { padding-top: 0.5em; }
            .mdn-anno > .feature > .support > span > span { padding: 0 0.5em; display: table-cell; }
            .mdn-anno > .feature > .support > span > span:first-child { width: 100%; }
            .mdn-anno > .feature > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
            .mdn-anno > .feature > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
            .mdn-anno > .feature > .support > .chrome_android::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
            .mdn-anno > .feature > .support > .firefox_android::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
            .mdn-anno > .feature > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
            .mdn-anno > .feature > .support > .edge_blink::before { background-image: url(https://resources.whatwg.org/browser-logos/edge.svg); }
            .mdn-anno > .feature > .support > .edge::before { background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg); }
            .mdn-anno > .feature > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
            .mdn-anno > .feature > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
            .mdn-anno > .feature > .support > .safari_ios::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
            .mdn-anno > .feature > .support > .nodejs::before { background-image: url(https://nodejs.org/static/images/favicons/favicon.ico); }
            .mdn-anno > .feature > .support > .opera_android::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.svg); }
            .mdn-anno > .feature > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.svg); }
            .mdn-anno > .feature > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
            .mdn-anno > .feature > .support > .samsunginternet_android::before { background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg); }
            .mdn-anno > .feature > .support > .webview_android::before { background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png); }
            .name-slug-mismatch { color: red }
            .caniuse-status:hover { z-index: 9; }

            /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
            .h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno { right: -6.7em; }
            .h-entry p + .mdn-anno { margin-top: 0; }
            h2 + .mdn-anno.after { margin: -48px 0 0 0; }
            h3 + .mdn-anno.after { margin: -46px 0 0 0; }
            h4 + .mdn-anno.after { margin: -42px 0 0 0; }
            h5 + .mdn-anno.after { margin: -40px 0 0 0; }
            h6 + .mdn-anno.after { margin: -40px 0 0 0; }
            </style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1>Content Security Policy: Embedded Enforcement</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2021-03-23">23 March 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec-cspee/">https://w3c.github.io/webappsec-cspee/</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/csp-embedded-enforcement/">https://www.w3.org/TR/csp-embedded-enforcement/</a>
     <dt>Previous Versions:
     <dd><a href="https://www.w3.org/TR/2015/WD-csp-embedded-enforcement-20160909/" rel="prev">https://www.w3.org/TR/2015/WD-csp-embedded-enforcement-20160909/</a>
     <dt>Version History:
     <dd><a href="https://github.com/w3c/webappsec-csp/commits/master/embedded/index.src.html">https://github.com/w3c/webappsec-csp/commits/master/embedded/index.src.html</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5Bcsp-embedded-enforcement%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[csp-embedded-enforcement] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Participate:
     <dd><a href="https://github.com/w3c/webappsec-csp/issues/new">File an issue</a> (<a href="https://github.com/w3c/webappsec-csp/issues">open issues</a>)
     <dt>Tests:
     <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/content-security-policy/embedded-enforcement">web-platform-tests content-security-policy/embedded-enforcement/</a> (<a href="https://github.com/web-platform-tests/wpt/labels/content-security-policy">ongoing work</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines a mechanism by which a web page can embed a nested

  browsing context if and only if it agrees to enforce a particular set of
  restrictions upon itself.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> <strong>Changes to this document may be tracked at <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong> </p>
   <p> The (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list <a href="mailto:public-webappsec@w3.org?Subject=%5Bcsp-embedded-enforcement%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a> (see <a href="https://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “csp-embedded-enforcement” in the subject,
	preferably like this:
	“[csp-embedded-enforcement] <em>…summary of comment…</em>” </p>
   <p> This document was produced by the <a href="https://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2020/Process-20200915/" id="w3c_process_revision">15 September 2020 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#examples"><span class="secno">1.1</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#csp-attribute"><span class="secno">2.1</span> <span class="content"><code>&lt;iframe></code>'s <code>csp</code> attribute</span></a>
      <li><a href="#required-csp-header"><span class="secno">2.2</span> <span class="content">The <code>Sec-Required-CSP</code> HTTP Request Header</span></a>
      <li><a href="#allow-csp-from-header"><span class="secno">2.3</span> <span class="content">The <code>Allow-CSP-From</code> HTTP Response Header</span></a>
      <li>
       <a href="#html-integration"><span class="secno">2.4</span> <span class="content">Integration with HTML</span></a>
       <ol class="toc">
        <li><a href="#required-csp"><span class="secno">2.4.1</span> <span class="content">Browsing Context’s Required CSP</span></a>
       </ol>
     </ol>
    <li>
     <a href="#implicit-opt-in"><span class="secno">3</span> <span class="content">Implicit Policy Acceptance</span></a>
     <ol class="toc">
      <li>
       <a href="#intersection"><span class="secno">3.1</span> <span class="content">Intersection</span></a>
       <ol class="toc">
        <li><a href="#intersection-policy-list"><span class="secno">3.1.1</span> <span class="content">CSP List intersection</span></a>
        <li><a href="#intersection-policy"><span class="secno">3.1.2</span> <span class="content">Policy Intersection</span></a>
        <li><a href="#intersection-source-list"><span class="secno">3.1.3</span> <span class="content">Source List Intersection</span></a>
        <li>
         <a href="#intersection-helpers"><span class="secno">3.1.4</span> <span class="content">Intersection Helpers</span></a>
         <ol class="toc">
          <li><a href="#effective-directive"><span class="secno">3.1.4.1</span> <span class="content">Effective Directive Value</span></a>
          <li><a href="#the-effective-source-list"><span class="secno">3.1.4.2</span> <span class="content">Effective Source List</span></a>
          <li><a href="#similarity-source-expressions"><span class="secno">3.1.4.3</span> <span class="content">Source Expression Similarity</span></a>
         </ol>
       </ol>
      <li><a href="#subsumption"><span class="secno">3.2</span> <span class="content">Subsumption</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">4</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#process-response"><span class="secno">4.1</span> <span class="content"> Is <var>response</var> to <var>request</var> blocked by <var>context</var>’s required CSP? </span></a>
      <li>
       <a href="#origin-allowed"><span class="secno">4.2</span> <span class="content"> Does <var>response</var> allow blanket enforcement of policy from <var>request</var>? </span></a>
       <ol class="toc">
        <li><a href="#intersection-source-expressions"><span class="secno">4.2.1</span> <span class="content"> What is an intersection of two expressions matching <span><code>scheme-source</code></span> or <span><code>host-source</code></span> grammar <var>A</var> and <var>B</var>? </span></a>
        <li><a href="#rewrite-self"><span class="secno">4.2.2</span> <span class="content"> Rewrite <code>'self'</code> into a host-source expression for <var>origin</var>. </span></a>
        <li><a href="#subsume-source-expressions"><span class="secno">4.2.3</span> <span class="content"> Does <code>source expression</code> <var>A</var> subsume <code>source expression</code> <var>B</var>? </span></a>
        <li><a href="#subsume-source-list"><span class="secno">4.2.4</span> <span class="content"> Does <span>source list</span> <var>A</var> subsume <span>source list</span><var>B</var> given their
    respective <span>origins</span> and directive names? </span></a>
        <li><a href="#subsume-policy"><span class="secno">4.2.5</span> <span class="content"> Does <span>policy</span> <var>A</var> subsume <span>policy</span> <var>B</var> given their respective <span>origins</span>? </span></a>
       </ol>
      <li><a href="#subsume-policy-list"><span class="secno">4.3</span> <span class="content"> Does <var>subsuming policy</var> subsume <var>policy list</var> given their respective <span>origins</span>? </span></a>
     </ol>
    <li>
     <a href="#security-and-privacy-considerations"><span class="secno">5</span> <span class="content">Security and Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#policy-enforcement"><span class="secno">5.1</span> <span class="content">Policy Enforcement</span></a>
      <li><a href="#policy-leakage"><span class="secno">5.2</span> <span class="content">Policy Leakage</span></a>
      <li><a href="#exfiltration"><span class="secno">5.3</span> <span class="content">Data Exfiltration</span></a>
      <li><a href="#header-injection"><span class="secno">5.4</span> <span class="content">Header Injection</span></a>
      <li><a href="#header-reflection"><span class="secno">5.5</span> <span class="content">Header Reflection</span></a>
     </ol>
    <li>
     <a href="#authoring-considerations"><span class="secno">6</span> <span class="content">Authoring Considerations</span></a>
     <ol class="toc">
      <li><a href="#effect-self"><span class="secno">6.1</span> <span class="content"> Requiring <code>'self'</code> </span></a>
     </ol>
    <li><a href="#iana"><span class="secno">7</span> <span class="content">IANA Considerations</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Content Security Policy is a great defense against cross-site scripting
  attacks, allowing developers to harden their own sites against injection of
  malicious script, style, and other resource types. It does not, however,
  give developers the ability to apply restrictions to third-party content
  loaded in via <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>. Allowing CSP to apply directly to these third-party
  contexts would be dangerous; CSP gives quite granular control over resource
  loading, and it’s very possible to introduce vulnerabilities into an otherwise
  secure page by denying it access to particular scripts. We’ve seen these kinds
  of issues in past features such as <code>X-XSS-Protection</code>, so we must be careful
  to avoid reintroducing them in a new form.</p>
   <p>That said, it would be quite useful to be able to place restrictions upon
  widgets, advertisements, and other kinds of third-party content. This document
  proposes a mechanism which relies on an explicit opt-in from the embedded
  content, which ought to make it possible for widgets to cooperate with their
  embedders to negotiate a reasonable set of restrictions.</p>
   <p>In short, the embedder proposes a Content Security Policy by setting an attribute on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code> element. This policy is transmitted along with the HTTP request for the framed content in an
  HTTP request header (<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp"><code>Sec-Required-CSP</code></a>). If the embedded content can accept that
  policy, it can enforce it by returning a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy"><code>Content-Security-Policy</code></a> or <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from"><code>Allow-CSP-From</code></a> header along with the response.</p>
   <p>If the response contains a policy at least as strict as the policy which the embedder requested,
  or accepts the embedder-provided policy, then the user agent will render the embedded content. If
  no such assertion is present, the response will be blocked.</p>
   <h3 class="heading settled" data-level="1.1" id="examples"><span class="secno">1.1. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
   <div class="example" id="example1">
    <a class="self-link" href="#example1"></a> MegaCorp Inc. wishes to ensure that the advertisements that run on its
    various publications are locked down to include script from trusted origins
    that have been audited for safety. They can do so by including the
    advertisement via an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element②">iframe</a></code> element with a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp">csp</a></code> attribute: 
<pre>&lt;iframe src="https://advertisements-r-us.example.com/ad1.cfm"
        <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp①">csp</a>="script-src https://trusted-cdn.example.com/">
&lt;/iframe>
</pre>
    <p>This will generate a request to <code>advertisements-r-us.example.com</code> that has
    a <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp①"><code>Sec-Required-CSP</code></a> header, as follows:</p>
<pre>GET / HTTP/1.1
Host: advertisements-r-us.example.com
...
<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp②">Sec-Required-CSP</a>: script-src https://trusted-cdn.example.com/
...
</pre>
    <p>The advertisement server parses this request header, decides that it’s acceptable, and adds a
    header to the response, informing the user agent that it will adhere to the restrictions imposed
    by its embedder (<code>https://example.com</code>):</p>
<pre>HTTP/1.1 200 OK
...
<a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from①">Allow-CSP-From</a>: https://example.com
</pre>
   </div>
   <div class="example" id="example2">
    <a class="self-link" href="#example2"></a> The advertisement server in the example above could also accept the restrictions by emitting its
    own <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy①"><code>Content-Security-Policy</code></a> header that’s at least as strong as the policy
    which the embedder requires. For example, it might wish to ensure that no plugins are loaded,
    regardless of what the embedder allows. It can do so by emitting a policy that includes the
    embedder’s restrictions, and adds more on top: 
<pre>HTTP/1.1 200 OK
...
<a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy②">Content-Security-Policy</a>: script-src https://trusted-cdn.example.com/; object-src 'none'
</pre>
    <p>Since the policy asserted by the response allows strictly fewer requests than the policy
    required by the request, the frame loads successfully.</p>
    <p>Note that the server could also deliver two policies, one which mirrors the restrictions of the
    embedder exactly, another which tightens them:</p>
<pre>HTTP/1.1 200 OK
...
<a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy③">Content-Security-Policy</a>: script-src https://trusted-cdn.example.com/, object-src 'none'
</pre>
    <p>The "<code>,</code>" in the <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy④"><code>Content-Security-Policy</code></a> header’s value splits the
    string into two serialized policies, each of which is enforced. The user
    agent verifies that one of the policies delivered with the response matches
    the requirement, and since additional policies can only make the <em>effective</em> policy for the page more restrictive, allows the frame
    to load successfully.</p>
   </div>
   <section>
    <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
    <p>At a high level, this document describes a mechanism by which an embedee can opt-into a set of
  restrictions specified by its embedder. The mechanism involves a few steps:</p>
    <ol>
     <li data-md>
      <p>The embedder specifies a required policy via a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp②">csp</a></code> attribute on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element③">iframe</a></code> element. This is described in more detail in <a href="#csp-attribute">§ 2.1 &lt;iframe>'s csp attribute</a>.</p>
     <li data-md>
      <p>That attribute’s value will be sent along with any <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request">navigation request</a> that targets
  the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element④">iframe</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a> in a <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp③"><code>Sec-Required-CSP</code></a> HTTP request header. This header is described in more detail in <a href="#required-csp-header">§ 2.2 The Sec-Required-CSP HTTP Request Header</a>.</p>
     <li data-md>
      <p>The server can examine the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp④"><code>Sec-Required-CSP</code></a> header to determine whether
  it wishes to accept the required policy.If so, it can implicitly opt-in by sending a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy⑤"><code>Content-Security-Policy</code></a> header in the response that contains a policy
  which is at least as strong as the required policy, or explicitly opt-in by sending an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from②"><code>Allow-CSP-From</code></a> header in the response that enables the embedding origin
  to set whatever policy it wishes. The explicit mechanism is straightforward, described in <a href="#allow-csp-from-header">§ 2.3 The Allow-CSP-From HTTP Response Header</a>. The implicit mechanism is quite complicated, and comprises the
  entire <a href="#implicit-opt-in">§ 3 Implicit Policy Acceptance</a> section.</p>
      <p>If the server doesn’t wish to accept the required policy, it can return an explicit error,
  or simply return the usual data without either a matching <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy⑥"><code>Content-Security-Policy</code></a> header or an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from③"><code>Allow-CSP-From</code></a> header. In this case, the user agent will block the response. This integration with HTML’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">navigate</a> algorithm is described in <a href="#html-integration">§ 2.4 Integration with HTML</a>, and the blocking mechanism
  is spelled out in <a href="#process-response">§ 4.1 Is response to request blocked by context’s required CSP?</a>.</p>
    </ol>
    <h3 class="heading settled" data-level="2.1" id="csp-attribute"><span class="secno">2.1. </span><span class="content"><code>&lt;iframe></code>'s <code>csp</code> attribute</span><a class="self-link" href="#csp-attribute"></a></h3>
    <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element⑤">iframe</a></code> elements have a <dfn class="dfn-paneled" data-dfn-for="iframe" data-dfn-type="element-attr" data-export id="element-attrdef-iframe-csp"><code>csp</code></dfn> attribute, which specifies
  the policy that an embedded document must agree to enforce upon itself. For example, the following
  HTML would load <code>https://embedee.example.com/</code>, and ensure that <code>object-src 'none'</code> was enforced
  upon it:</p>
    <div class="example" id="example-616844b8">
     <a class="self-link" href="#example-616844b8"></a> 
<pre>&lt;iframe src="https://embedee.example.com/" <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp③">csp</a>="object-src 'none'">
&lt;/iframe>
</pre>
    </div>
    <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> (<var>value</var>) is a <dfn class="dfn-paneled" data-dfn-for="iframe/csp" data-dfn-type="dfn" data-noexport id="iframe-csp-valid-attribute-value">valid attribute value</dfn> for a given <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element">element</a> (<var>element</var>)'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp④">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes">content attribute</a> if all of the
  following statements are true:</p>
    <ol>
     <li data-md>
      <p><var>value</var> is not the empty string.</p>
     <li data-md>
      <p><var>value</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy" id="ref-for-grammardef-serialized-policy">serialized-policy</a> ABNF grammar defined in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>.</p>
     <li data-md>
      <p>One of the following statements is true:</p>
      <ol>
       <li data-md>
        <p><var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a>'s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp">required CSP</a> is <code>null</code>.</p>
       <li data-md>
        <p>The result of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#parse-serialized-policy" id="ref-for-parse-serialized-policy">parsing</a> <var>value</var> as "<code>enforce</code>" is <a data-link-type="dfn" href="#policy-subsumed-by" id="ref-for-policy-subsumed-by">subsumed by</a> <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a>'s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp①">required CSP</a>.</p>
      </ol>
     <li data-md>
      <p>The result of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#parse-serialized-policy" id="ref-for-parse-serialized-policy①">parsing</a> <var>value</var> as "<code>enforce</code>" has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set">directive set</a> that does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> any of the following directives:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#report-uri" id="ref-for-report-uri">report-uri</a></p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#report-to" id="ref-for-report-to">report-to</a></p>
      </ul>
    </ol>
    <div class="example" id="example-475713d6">
     <a class="self-link" href="#example-475713d6"></a> The following strings are valid values for the <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp⑤">csp</a></code> attribute, as they’re valid CSP
    grammar: 
     <ul>
      <li data-md>
       <p><code>script-src 'none'</code></p>
      <li data-md>
       <p><code>script-src 'self'; object-src 'none'; sandbox</code></p>
      <li data-md>
       <p><code>not-a-directive https://whatever.not-a-tld</code></p>
     </ul>
     <p class="note" role="note"><span>Note:</span> We consider the last item valid even though it doesn’t express a meaningful policy in
    order to remain forward-compatible with future CSP syntax.</p>
     <p>The following, on the other hand, do not match the CSP syntax, and would not be considered valid
    attribute values:</p>
     <ul>
      <li data-md>
       <p><code>script-src *\nInjected-Header: XSS!</code></p>
      <li data-md>
       <p><code>💩</code></p>
     </ul>
     <p class="note" role="note"><span>Note:</span> We need to be careful about the values we allow in the <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp⑥">csp</a></code> attribute, as its
    contents will end up reflected as an HTTP request header. This concern is discussed in a little
    more detail in <a href="#header-injection">§ 5.4 Header Injection</a>.</p>
    </div>
    <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element⑥">iframe</a></code>'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp⑦">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes①">content attribute</a> has a corresponding IDL attribute, defined
  by the following WebIDL grammar <a data-link-type="biblio" href="#biblio-webidl">[WEBIDL]</a>:</p>
    <div class="mdn-anno wrapped">
     <button class="mdn-anno-btn"><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></button>
     <div class="feature">
      <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement/csp" title="The csp property of the HTMLIFrameElement interface specifies the Content Security Policy that an embedded document must agree to enforce upon itself.">HTMLIFrameElement/csp</a></p>
      <p class="less-than-two-engines-text">In only one current engine.</p>
      <div class="support">
       <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>61+</span></span>
       <hr>
       <span class="opera yes"><span>Opera</span><span>48+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
       <hr>
       <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span class="ie no"><span>IE</span><span>None</span></span>
       <hr>
       <span class="firefox_android no"><span>Firefox for Android</span><span>None</span></span><span class="safari_ios no"><span>iOS Safari</span><span>None</span></span><span class="chrome_android yes"><span>Chrome for Android</span><span>61+</span></span><span class="webview_android yes"><span>Android WebView</span><span>61+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Mobile</span><span>45+</span></span>
      </div>
     </div>
    </div>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement"><c- g>HTMLIFrameElement</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLIFrameElement" data-dfn-type="attribute" data-export data-type="DOMString" id="dom-htmliframeelement-csp"><code><c- g>csp</c-></code></dfn>;
};
</pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-htmliframeelement-csp" id="ref-for-dom-htmliframeelement-csp">csp</a></code> IDL attribute must <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-reflect" id="ref-for-concept-reflect">reflect</a> the element’s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp⑧">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes②">content attribute</a>.</p>
    <p class="issue" id="issue-2a91d948"><a class="self-link" href="#issue-2a91d948"></a> Upstream this to all the HTMLs.</p>
    <h3 class="heading settled" data-level="2.2" id="required-csp-header"><span class="secno">2.2. </span><span class="content">The <code>Sec-Required-CSP</code> HTTP Request Header</span><a class="self-link" href="#required-csp-header"></a></h3>
    <p>In order to ensure that the embedded resource can decide whether or not it is willing to adhere to
  the embedder’s requirements, the policy expressed in an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element⑦">iframe</a></code>'s <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp⑨">csp</a></code> attribute is
  communicated along with affected <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request①">navigation requests</a> via a
  "<dfn class="dfn-paneled" data-dfn-type="http-header" data-export id="http-headerdef-sec-required-csp"><code>Sec-Required-CSP</code></dfn>" HTTP request header. The header’s value is
  represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>
<pre>Sec-Required-CSP = <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy" id="ref-for-grammardef-serialized-policy①">serialized-policy</a>
</pre>
    <p>A user agent MUST NOT send more than one HTTP response header field named "<code>Sec-Required-CSP</code>", and
  any such header MUST NOT contain more than one <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy" id="ref-for-grammardef-serialized-policy②">serialized-policy</a>.</p>
    <p>Servers MUST process only the first policy in the first such header received. As discussed in <a href="#header-reflection">§ 5.5 Header Reflection</a>, servers SHOULD also carefully consider the implications of simply
  reflecting a policy back to a client. If the server wishes to simply accept an embedder’s
  requirements, the <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from④"><code>Allow-CSP-From</code></a> header is a safer choice.</p>
    <p>This header is set as part of HTML’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">navigate</a> algorithm (see <a href="#html-integration">§ 2.4 Integration with HTML</a> for
  details on the hook that calls the following algorithm):</p>
    <div class="algorithm" data-algorithm="set a request’s required-csp header">
      To <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export data-local-lt="set-required-csp" id="abstract-opdef-set-the-sec-required-csp-header">set the <code>Sec-Required-CSP</code> header</dfn> for a
    given <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> (<var>request</var>), run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>request</var> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request②">navigation request</a>, return.</p>
      <li data-md>
       <p>Let <var>requirement</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>’s <a data-link-type="dfn">responsible browsing context</a>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp②">required CSP</a>.</p>
      <li data-md>
       <p>If <var>requirement</var> is <code>null</code>, return.</p>
      <li data-md>
       <p class="assertion">Assert: <var>requirement</var> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp">serialized CSP</a>, matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy" id="ref-for-grammardef-serialized-policy③">serialized-policy</a> grammar defined in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">Append</a> a header named "<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp⑤"><code>Sec-Required-CSP</code></a>" with a
  value of <var>requirement</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>.</p>
     </ol>
    </div>
    <h3 class="heading settled" data-level="2.3" id="allow-csp-from-header"><span class="secno">2.3. </span><span class="content">The <code>Allow-CSP-From</code> HTTP Response Header</span><a class="self-link" href="#allow-csp-from-header"></a></h3>
    <p>An embedee can opt-into accepting a policy specified by an embedder by responding with a
  "<dfn class="dfn-paneled" data-dfn-type="http-header" data-export id="http-headerdef-allow-csp-from"><code>Allow-CSP-From</code></dfn>" HTTP response header. The header’s value is
  represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>
<pre>Allow-CSP-From = <a data-link-type="grammar" href="https://fetch.spec.whatwg.org/#http-origin" id="ref-for-http-origin">origin-or-null</a> / <a data-link-type="grammar" href="https://fetch.spec.whatwg.org/#http-new-header-syntax" id="ref-for-http-new-header-syntax">wildcard</a>
</pre>
    <h3 class="heading settled" data-level="2.4" id="html-integration"><span class="secno">2.4. </span><span class="content">Integration with HTML</span><a class="self-link" href="#html-integration"></a></h3>
    <ol>
     <li data-md>
      <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element⑧">iframe</a></code> elements have a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp①⓪">csp</a></code> attribute, defined in <a href="#csp-attribute">§ 2.1 &lt;iframe>'s csp attribute</a>.</p>
     <li data-md>
      <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp③">required CSP</a>, defined in <a href="#required-csp">§ 2.4.1 Browsing Context’s Required CSP</a>.</p>
     <li data-md>
      <p>Add the following after step 10 of HTML’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">navigate</a> algorithm:</p>
      <ol start="11">
       <li data-md>
        <p><a data-link-type="abstract-op" href="#abstract-opdef-set-the-required-csp" id="ref-for-abstract-opdef-set-the-required-csp">Set</a> <code>browsingContext</code>'s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp④">required CSP</a>.</p>
      </ol>
      <p class="issue" id="issue-fdc1da1f"><a class="self-link" href="#issue-fdc1da1f"></a> Upstream this to WHATWG’s HTML.</p>
      <p class="issue" id="issue-4457804d"><a class="self-link" href="#issue-4457804d"></a> W3C’s HTML’s navigation algorithm is wildly divergent from WHATWG’s at
  this point. Upstream something to that document once things are reconciled. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
     <li data-md>
      <p>Add the following to the list of error conditions in step 1 of HTML’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response" id="ref-for-process-a-navigate-response">process a navigate response</a> algorithm:</p>
      <ul>
       <li data-md>
        <p>The <a href="#process-response">§ 4.1 Is response to request blocked by context’s required CSP?</a> algorithm returns "<code>Blocked</code>" when executed
  upon <code>response</code>, <code>request</code>, and <code>browsingContext</code>.</p>
      </ul>
      <p class="issue" id="issue-fdc1da1f①"><a class="self-link" href="#issue-fdc1da1f①"></a> Upstream this to WHATWG’s HTML.</p>
      <p class="issue" id="issue-ed7a45a9"><a class="self-link" href="#issue-ed7a45a9"></a> W3C’s HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response" id="ref-for-process-a-navigate-response①">process a navigate response</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
     <li data-md>
      <p>Add the following after step 5 of HTML’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch">process a navigate fetch</a> algorithm:</p>
      <ol start="6">
       <li data-md>
        <p><a data-link-type="abstract-op" href="#abstract-opdef-set-the-sec-required-csp-header" id="ref-for-abstract-opdef-set-the-sec-required-csp-header">Set</a> <code>request</code>'s
  "<a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp⑥"><code>Sec-Required-CSP</code></a>" header.</p>
      </ol>
      <p class="issue" id="issue-fdc1da1f②"><a class="self-link" href="#issue-fdc1da1f②"></a> Upstream this to WHATWG’s HTML.</p>
      <p class="issue" id="issue-df6fcac2"><a class="self-link" href="#issue-df6fcac2"></a> W3C’s HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch①">process a navigate fetch</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a></p>
    </ol>
    <h4 class="heading settled" data-level="2.4.1" id="required-csp"><span class="secno">2.4.1. </span><span class="content">Browsing Context’s Required CSP</span><a class="self-link" href="#required-csp"></a></h4>
    <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context①">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-for="browsing context" data-dfn-type="dfn" data-noexport id="browsing-context-required-csp">required CSP</dfn>, which is either <code>null</code> or a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp①">serialized CSP</a>. The value is set during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate③">navigate</a> algorithm, and will
  not change until the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document">active document</a> changes.</p>
    <p>The following algorithm will execute at around step 10 of the current <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate④">navigate</a> algorithm:</p>
    <div class="algorithm" data-algorithm="browsing context’s required CSP">
      To <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-set-the-required-csp">set the required CSP</dfn> for a given <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> (<var>context</var>),
    run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>context</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context①">nested browsing context</a>:</p>
       <ol>
        <li data-md>
         <p>If <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container" id="ref-for-browsing-context-container">browsing context container</a> has an <code><a data-link-type="element-sub" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp①①">csp</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes③">content
  attribute</a> with a <a data-link-type="dfn" href="#iframe-csp-valid-attribute-value" id="ref-for-iframe-csp-valid-attribute-value">valid attribute value</a> (<var>value</var>), set <var>context</var>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp⑤">required CSP</a> to <var>value</var> and return.</p>
        <li data-md>
         <p>Set <var>context</var>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp⑥">required CSP</a> to the value of <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context" id="ref-for-parent-browsing-context">parent browsing context</a>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp⑦">required CSP</a>.</p>
        <li data-md>
         <p>Return.</p>
       </ol>
      <li data-md>
       <p>Set <var>context</var>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp⑧">required CSP</a> to <code>null</code>.</p>
     </ol>
    </div>
    <p class="issue" id="issue-b71d345b"><a class="self-link" href="#issue-b71d345b"></a> Upstream a hook to HTML.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="implicit-opt-in"><span class="secno">3. </span><span class="content">Implicit Policy Acceptance</span><a class="self-link" href="#implicit-opt-in"></a></h2>
    <p>An embedee can explicitly accept a policy requirement specified by its embedder by returning an <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from⑤"><code>Allow-CSP-From</code></a> header along with a response. The requirement can also be
  implicitly accepted by delivering a <a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy⑦"><code>Content-Security-Policy</code></a> header that
  contains a policy (or set of policies) whose net effect is at least as strict as the policy
  required by the embedder.</p>
    <p>"At least as strict", however, isn’t very precise. Simple cases are straightforward: if an
  embedder requires <code>object-src https://cdn.example.com</code>, the embedee can respond with <code>object-src 'none'</code>. Since every possible resource that would be blocked by the former would also be blocked
  by the latter (because it allows no objects at all), we wouldn’t block the embedding. CSP’s
  syntactical complexity makes this a little bit difficult to reason about for more complicated
  cases. For instance, given <code>script-src 'unsafe-inline' http: 'sha256-abc...def'</code>, it might appear
  that <code>script-src 'unsafe-inline'</code> would be a subset of the required policy. The presence of the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source">hash-source</a> expression, however means that <code>'unsafe-inline'</code> is ignored in the
  required policy, so the latter policy would actually allow more than the former, despite
  appearances.</p>
    <p>To formalize the concept a bit, we need a few terms, and more than a few algorithms:</p>
    <ul>
     <li data-md>
      <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy">policy</a> (<var>A</var>) is said to <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-export id="policy-subsume">subsume</dfn> another <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy①">policy</a> (<var>B</var>) if <var>B</var> is at least as strict as <var>A</var>. In this case <var>B</var> could also be said to be <dfn class="dfn-paneled" data-dfn-for="policy" data-dfn-type="dfn" data-export id="policy-subsumed-by">subsumed by</dfn> <var>A</var>. The details of determining "at least as
  strict"ness are spelled out in <a href="#subsumption">§ 3.2 Subsumption</a>.</p>
     <li data-md>
      <p>When multiple policies are present, they have a combined effect which is described in <a href="https://www.w3.org/TR/CSP3/#multiple-policies">"The effect of multiple policies"</a>. Here, we’ll talk about the
  combined effect of a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list">CSP list</a> as their <a data-link-type="dfn" href="#csp-list-intersection" id="ref-for-csp-list-intersection">intersection</a>. The details of
  determining that are spelled out in <a href="#intersection">§ 3.1 Intersection</a>.</p>
     <li data-md>
      <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy②">policy</a> (<var>A</var>) is said to <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume">subsume</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list①">CSP list</a> if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume①">subsumes</a> their <a data-link-type="dfn" href="#csp-list-intersection" id="ref-for-csp-list-intersection①">intersection</a>.</p>
    </ul>
    <h3 class="heading settled" data-level="3.1" id="intersection"><span class="secno">3.1. </span><span class="content">Intersection</span><a class="self-link" href="#intersection"></a></h3>
    <h4 class="heading settled algorithm" data-algorithm="CSP List intersection" data-level="3.1.1" id="intersection-policy-list"><span class="secno">3.1.1. </span><span class="content">CSP List intersection</span><a class="self-link" href="#intersection-policy-list"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-for="CSP list" data-dfn-type="dfn" data-export id="csp-list-intersection">intersection</dfn> of a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#csp-list" id="ref-for-csp-list②">CSP list</a> (<var>list</var>) for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> (<var>origin</var>) is a single <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#content-security-policy-object" id="ref-for-content-security-policy-object">Content Security Policy object</a> representing their net effect,
  produced by the following algorithm:</p>
    <p class="note" role="note"><span>Note:</span> It isn’t always possible to represent the <a data-link-type="dfn" href="#csp-list-intersection" id="ref-for-csp-list-intersection②">intersection</a> of multiple policies as
  a single policy. Consider <code>script-src 'unsafe-inline'</code> and <code>script-src 'nonce-abc'</code>, for instance:
  the former allows only inline script, the latter allows only inline or externalized script with a
  particular token. The net effect (only inline script with a particular token) cannot be created
  with a single policy. Dealing with such policies is, for the moment, left as an exercise for the
  reader.</p>
    <p class="issue" id="issue-f2ff64e0"><a class="self-link" href="#issue-f2ff64e0"></a> We shouldn’t make the reader do this exercise.</p>
    <ol class="algorithm">
     <li data-md>
      <p>Let <var>result</var> be a <a data-link-type="dfn">policy</a> object with an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①">directive set</a> and a disposition of "<code>enforce</code>".</p>
     <li data-md>
      <p>For each <var>policy</var> in <var>list</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition">disposition</a> is "<code>report</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>Set <var>result</var> to the <a data-link-type="dfn" href="#content-security-policy-object-intersection" id="ref-for-content-security-policy-object-intersection">intersection</a> of <var>result</var> and <var>policy</var> for <var>origin</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
    <div class="example" id="example-49505f13">
     <a class="self-link" href="#example-49505f13"></a> The intersection of the policies created by parsing each item in the following list of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp②">serialized CSPs</a>: 
<pre>«
    "default-src 'self' http://example.com http://example.net;
     connect-src 'none';",
    "connect-src http://example.com/;
     script-src http://example.com/",
    "style-src 'self';
     script-src http://example.com/ http://example.net",
»
</pre>
     <p>is the policy created by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp③">serialized CSP</a>:</p>
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';
 script-src http://example.com/;
 style-src 'self'"
</pre>
     <p>Each policy specified in the initial list <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume②">subsumes</a> the intersection.</p>
    </div>
    <h4 class="heading settled" data-level="3.1.2" id="intersection-policy"><span class="secno">3.1.2. </span><span class="content">Policy Intersection</span><a class="self-link" href="#intersection-policy"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-for="content security policy object" data-dfn-type="dfn" data-noexport id="content-security-policy-object-intersection">intersection</dfn> of two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#content-security-policy-object" id="ref-for-content-security-policy-object①">Content Security Policy
  objects</a> (<var>A</var> and <var>B</var>) for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin①">origin</a> (<var>origin</var>) is a single <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#content-security-policy-object" id="ref-for-content-security-policy-object②">Content Security Policy
  object</a> representing their combined effect, produced by the following algorithm:</p>
    <ol class="algorithm">
     <li data-md>
      <p class="assertion">Assert: <var>A</var> and <var>B</var> both have a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition①">disposition</a> of "<code>enforce</code>".</p>
     <li data-md>
      <p>If <var>A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set②">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">is empty</a>, return <var>B</var>.</p>
     <li data-md>
      <p>If <var>B</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set③">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty①">is empty</a>, return <var>A</var>.</p>
     <li data-md>
      <p>Let <var>policy</var> be a new <a data-link-type="dfn">policy</a> with an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set④">directive set</a>, and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition②">disposition</a> "<code>enforce</code>".</p>
     <li data-md>
      <p>Let <var>directive names</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a>.</p>
     <li data-md>
      <p>For each <var>directive</var> in <var>A</var>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name">name</a> to <var>directive names</var>.</p>
      </ol>
     <li data-md>
      <p>For each <var>directive</var> in <var>B</var>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">Append</a> <var>directive</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①">name</a> to <var>directive names</var>.</p>
      </ol>
     <li data-md>
      <p>For each <var>directive name</var> in <var>directive names</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>directive name</var> is "<code>report-uri</code>", "<code>report-to</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p>Let <var>directive A</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value">effective directive value</a> for <var>directive name</var> and <var>A</var>.</p>
       <li data-md>
        <p>Let <var>directive B</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value①">effective directive value</a> for <var>directive name</var> and <var>B</var>.</p>
       <li data-md>
        <p class="assertion">Assert: <var>directive A</var> and <var>directive B</var> are not both <code>null</code>, and either both of their <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value">values</a> are <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists">source lists</a>, or neither of their <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①">values</a> are <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists①">source lists</a>.</p>
       <li data-md>
        <p>If either <var>directive A</var> or <var>directive B</var> has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value②">value</a> which is
  not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists②">source list</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
        <p class="issue" id="issue-5b9d5f29"><a class="self-link" href="#issue-5b9d5f29"></a> We need to extend this definition to handle things that are not source lists.
  Also, we should be more precise about this, perhaps by defining a term like "source list
  directive" that we could check against <var>directive name</var>.</p>
       <li data-md>
        <p>If <var>directive A</var> is <code>null</code>:</p>
        <ol>
         <li data-md>
          <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives">directive</a> with the following properties:</p>
          <dl>
           <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name②">name</a>
           <dd data-md>
            <p><var>directive name</var></p>
           <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value③">value</a>
           <dd data-md>
            <p><var>directive B</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value④">value</a></p>
          </dl>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append②">append</a> a <var>directive</var> to <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set⑤">directive set</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">Continue</a>.</p>
        </ol>
       <li data-md>
        <p>If <var>directive B</var> is <code>null</code>:</p>
        <ol>
         <li data-md>
          <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①">directive</a> with the following properties:</p>
          <dl>
           <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name③">name</a>
           <dd data-md>
            <p><var>directive name</var></p>
           <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑤">value</a>
           <dd data-md>
            <p><var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑥">value</a></p>
          </dl>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append③">append</a> a <var>directive</var> to <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set⑥">directive set</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">Continue</a>.</p>
        </ol>
       <li data-md>
        <p>Let <var>directive value</var> be the <a data-link-type="dfn" href="#source-list-intersection" id="ref-for-source-list-intersection">intersection</a> of <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑦">value</a>, <var>directive B</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑧">value</a>, <var>directive
  name</var>, and <var>origin</var>.</p>
       <li data-md>
        <p>Let <var>directive</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives②">directive</a> with he following properties:</p>
        <dl>
         <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name④">name</a>
         <dd data-md>
          <p><var>directive name</var></p>
         <dt data-md><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value⑨">value</a>
         <dd data-md>
          <p><var>directive value</var></p>
        </dl>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append④">Append</a> <var>directive</var> to <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set⑦">directive set</a>.</p>
      </ol>
     <li data-md>
      <p>Return <var>policy</var>.</p>
    </ol>
    <div class="example" id="example-c6cc30a5">
     <a class="self-link" href="#example-c6cc30a5"></a> The intersection of the policies obtained by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp④">serialized CSPs</a>: 
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';"

and

"connect-src http://example.com/;
 script-src http://example.com/"
</pre>
     <p>is the policy obtained by parsing the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#serialized-csp" id="ref-for-serialized-csp⑤">serialized CSP</a>:</p>
<pre>"default-src 'self' http://example.com http://example.net;
 connect-src 'none';
 script-src http://example.com/;
</pre>
     <p>Both of the given policies <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume③">subsume</a> the <a data-link-type="dfn" href="#csp-list-intersection" id="ref-for-csp-list-intersection③">intersection</a>. For example,
    the <a data-link-type="dfn" href="#csp-list-intersection" id="ref-for-csp-list-intersection④">intersection</a>’s "<code>script-src http://example.com/</code>" is <a data-link-type="dfn" href="#policy-subsumed-by" id="ref-for-policy-subsumed-by①">subsumed by</a> the first policy’s "<code>default-src 'self' http://example.com http://example.net</code>" and the second policy’s "<code>script-src http://example.com/</code>".</p>
    </div>
    <h4 class="heading settled" data-level="3.1.3" id="intersection-source-list"><span class="secno">3.1.3. </span><span class="content">Source List Intersection</span><a class="self-link" href="#intersection-source-list"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-for="source list" data-dfn-type="dfn" data-noexport id="source-list-intersection">intersection</dfn> of two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists③">source lists</a> for a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name⑤">directive name</a> (<var>name</var>) and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin②">origin</a> (<var>origin</var>) is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists④">source list</a> representing their net effect. If no such <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists⑤">source list</a> exists (for example, <code>https://example.com/</code> in <var>A</var> and <code>https://not-example.com</code> in <var>B</var>), then the intersection will
  be the list « <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none">'none'</a> ».</p>
    <ol class="algorithm">
     <ol>
      <li data-md>
       <p>Let <var>effective A</var> be the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list">effective source list</a> for <var>A</var>, <var>name</var>, and <var>origin</var>.</p>
      <li data-md>
       <p>Let <var>effective B</var> be the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list①">effective source list</a> for <var>B</var>, <var>name</var>, and <var>origin</var>.</p>
      <li data-md>
       <p>If either <var>effective A</var> or <var>effective B</var> is « <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none①"><code>'none'</code></a> »,
  return « <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none②"><code>'none'</code></a> ».</p>
      <li data-md>
       <p>If <var>effective A</var> is empty, return <var>effective B</var>.</p>
      <li data-md>
       <p>If <var>effective B</var> is empty, return <var>effective A</var>.</p>
     </ol>
     <p>6   Let <var>schemes</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a>.</p>
     <ol start="7">
      <li data-md>
       <p>Let <var>intersection</var> be an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists⑥">source list</a>.</p>
      <li data-md>
       <p>For each <var>expression B</var> in <var>effective B</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>expression B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source"><code>scheme-source</code></a> grammar and <var>expression B</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contained</a> in <var>effective A</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑤">append</a> <var>expression B</var> to <var>schemes</var>.</p>
         <p class="note" role="note"><span>Note:</span> Getting the <a data-link-type="dfn" href="#effective-source-list" id="ref-for-effective-source-list②">effective source list</a> above means that tokens matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①"><code>scheme-source</code></a> grammar have already been normalized such that
  "<code>http:</code>"/"<code>ws:</code>" never appears without "<code>https:</code>"/"<code>ws:</code>" also appearing.</p>
       </ol>
      <li data-md>
       <p>For each <var>expression</var> in <var>schemes</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>expression</var> does not match "<code>https:</code>" or <var>schemes</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">contain</a> "<code>http:</code>":</p>
         <ol>
          <li data-md>
           <p>If <var>expression</var> does not match "<code>wss:</code>" or <var>schemes</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain③">contain</a> "<code>ws:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑥">append</a> <var>expression</var> to <var>intersection</var>.</p>
         </ol>
       </ol>
      <li data-md>
       <p>For each <var>expression A</var> in <var>effective A</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source②"><code>scheme-source</code></a> grammar
  and <var>schemes</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain④">contains</a> <var>expression A</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>.</p>
        <li data-md>
         <p>For each <var>expression B</var> in <var>effective B</var>:</p>
         <ol>
          <li data-md>
           <p>If at least one of <var>expression A</var> and <var>expression B</var> does not
  match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source③"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source"><code>host-source</code></a> grammar:</p>
           <ol>
            <li data-md>
             <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source"><code>keyword-source</code></a> grammar and is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> match for <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑦">append</a> <var>expression A</var> to <var>intersection</var>.</p>
            <li data-md>
             <p>If <var>expression A</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source"><code>nonce-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source①"><code>hash-source</code></a> grammar and is a <a data-link-type="dfn">case-sensitive</a> match for <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑧">append</a> <var>expression A</var> to <var>intersection</var>.</p>
            <li data-md>
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">Continue</a> to the next <var>expression B</var>.</p>
           </ol>
          <li data-md>
           <p>If <var>expression B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part"><code>scheme-part</code></a> matches one of
  the elements in <var>schemes</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑦">continue</a> to the
  next <var>expression B</var>.</p>
          <li data-md>
           <p>If the result of executing <a href="#intersection-source-expressions">§ 4.2.1 What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B?</a> is
  not <code>null</code> given <var>expression A</var> and <var>expression B</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑨">append</a> the result to <var>intersection</var>.</p>
         </ol>
       </ol>
      <li data-md>
       <p>Return <var>intersection</var>.</p>
     </ol>
    </ol>
    <div class="example" id="example-0d4f89f3">
     <a class="self-link" href="#example-0d4f89f3"></a> In these cases, <code>intersection</code> is an <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection">intersection</a> for <var>A</var> and <var>B</var>. 
<pre>A = wss: http://example.com
B = https: wss: 'none'
intersection = wss: https://example.com
</pre>
     <p>The expression "wss:" is present in both policies, so it is present in
    their intersection. Similarly, "http://example.com" is present in the
    intersection because it is the only expression subsumed by both
    "http://example.com" and "https:". Note that "'none'"" is ignored, as it is
    not the only token in <var>B</var>.</p>
<pre>A = http://*.a.com http://*.b.com
B = https://a.com:* http://*.c.com
intersection = https://a.com
</pre>
     <p>Only two sources are similar: "http://*.a.com" in <var>A</var> is similar to
    "https://a.com:*" in <var>B</var> so the intersection of the two source lists is
    "https://a.com".</p>
<pre>A = 'unsafe-inline' http://example.com:443/page1/html 'nonce-abc'
B = 'unsafe-inline' https://example.com:443/ 'strict-dynamic' 'nonce-abc'
intersection = 'nonce-abc'
</pre>
     <p>Since "<code>strict-dynamic</code>" honors only <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source①"><code>nonce-source</code></a> and <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source②"><code>hash-source</code></a> expressions, <var>B</var> is effectively
    "'strict-dynamic' 'nonce-abc'". That is why the intersection is
    "'nonce-abc'".</p>
    </div>
    <h4 class="heading settled" data-level="3.1.4" id="intersection-helpers"><span class="secno">3.1.4. </span><span class="content">Intersection Helpers</span><a class="self-link" href="#intersection-helpers"></a></h4>
    <h5 class="heading settled" data-level="3.1.4.1" id="effective-directive"><span class="secno">3.1.4.1. </span><span class="content">Effective Directive Value</span><a class="self-link" href="#effective-directive"></a></h5>
    <div class="algorithm" data-algorithm="effective directive">
      Given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> (<var>name</var>) and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy③">policy</a> (<var>policy</var>), the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="effective directive value" id="effective-directive-value">effective directive value for <var>name</var> and <var>policy</var></dfn> is the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①⓪">value</a> resulting from running the following steps: 
     <ol>
      <li data-md>
       <p>Switch on <var>name</var> and execute the associated steps:</p>
       <dl>
        <dt data-md>"<code>child-src</code>"
        <dt data-md>"<code>connect-src</code>"
        <dt data-md>"<code>font-src</code>"
        <dt data-md>"<code>img-src</code>"
        <dt data-md>"<code>manifest-src</code>"
        <dt data-md>"<code>media-src</code>"
        <dt data-md>"<code>object-src</code>"
        <dt data-md>"<code>script-src</code>"
        <dt data-md>"<code>style-src</code>"
        <dd data-md>
         <ol>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set⑧">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑤">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives③">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name⑥">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives④">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①①">value</a>.</p>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set⑨">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑥">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives⑤">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name⑦">name</a> is "<code>default-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives⑥">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①②">value</a>.</p>
          <li data-md>
           <p>Return <code>null</code>.</p>
         </ol>
        <dt data-md>"<code>frame-src</code>"
        <dt data-md>"<code>worker-src</code>"
        <dd data-md>
         <ol>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①⓪">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑦">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives⑦">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name⑧">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives⑧">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①③">value</a>.</p>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①①">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑧">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives⑨">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name⑨">name</a> is "<code>child-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①⓪">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①④">value</a>.</p>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①②">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑨">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①①">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①⓪">name</a> is "<code>default-src</code>", return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①②">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①⑤">value</a>.</p>
          <li data-md>
           <p>Return <code>null</code>.</p>
         </ol>
        <dt data-md>"<code>base-uri</code>"
        <dt data-md>"<code>block-all-mixed-content</code>"
        <dt data-md>"<code>default-src</code>"
        <dt data-md>"<code>frame-ancestors</code>"
        <dt data-md>"<code>form-action</code>"
        <dt data-md>"<code>plugin-types</code>"
        <dt data-md>"<code>report-uri</code>"
        <dt data-md>"<code>require-sri-for</code>"
        <dt data-md>"<code>sandbox</code>"
        <dt data-md>"<code>upgrade-insecure-requests</code>"
        <dd data-md>
         <ol>
          <li data-md>
           <p>If <var>policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①③">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①⓪">contains</a> a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①③">directive</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①①">name</a> is <var>name</var>, return that <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①④">directive</a>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①⑥">value</a>.</p>
          <li data-md>
           <p>Return <code>null</code>.</p>
         </ol>
       </dl>
      <li data-md>
       <p>Return <code>null</code>.</p>
     </ol>
    </div>
    <h5 class="heading settled" data-level="3.1.4.2" id="the-effective-source-list"><span class="secno">3.1.4.2. </span><span class="content">Effective Source List</span><a class="self-link" href="#the-effective-source-list"></a></h5>
    <div class="algorithm" data-algorithm="effective source list">
      Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists⑦">source list</a> (<var>list</var>), a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> (<var>name</var>), and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin③">origin</a> (<var>origin</var>), the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="effective source list" data-noexport id="effective-source-list">effective source list for <var>list</var>, <var>name</var>, and <var>origin</var></dfn> is a simplification of <var>list</var> that expands complex tokens like <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self"><code>'self'</code></a> and <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-zero-plus" id="ref-for-mult-zero-plus"><code>*</code></a>, and removes ineffective, obviated, or invalid
    tokens (for instance, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline" id="ref-for-grammardef-unsafe-inline"><code>'unsafe-inline'</code></a> in the presence of a nonce). The result
    of running the following steps will generally be more verbose than <var>list</var>, but will be
    significantly simpler to compare: 
     <ol>
      <li data-md>
       <p>If <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty②">is empty</a> or « 'none' », return « 'none' ».</p>
      <li data-md>
       <p>Let <var>result</var> be an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists⑧">source list</a>.</p>
      <li data-md>
       <p>For each <var>expression</var> in <var>list</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self①"><code>'self'</code></a>":</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①⓪">Append</a> the result of executing <a href="#rewrite-self">§ 4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin</var> to <var>result</var>.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑧">Continue</a>.</p>
         </ol>
        <li data-md>
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source①"><code>keyword-source</code></a> grammar, and <var>name</var> is not
  "<code>script-src</code>" or "<code>style-src</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑨">continue</a>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⓪">Continue</a> if any of the following statements are true:</p>
         <ul>
          <li data-md>
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-none" id="ref-for-grammardef-none③"><code>'none'</code></a>"</p>
          <li data-md>
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic" id="ref-for-grammardef-strict-dynamic"><code>'strict-dynamic'</code></a>" and <var>name</var> is not "<code>script-src</code>"</p>
          <li data-md>
           <p><var>expression</var> matches either the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source②"><code>nonce-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source③"><code>hash-source</code></a> grammar, and <var>name</var> is not "<code>script-src</code>" or
  "<code>style-src</code>"</p>
          <li data-md>
           <p><var>expression</var> is "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline" id="ref-for-grammardef-unsafe-inline①"><code>'unsafe-inline'</code></a>", <var>name</var> is "<code>script-src</code>, and <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①①">contains</a> one or more tokens that match one of the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source③"><code>nonce-source</code></a> grammar, the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source④"><code>hash-source</code></a> grammar,
  or "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic" id="ref-for-grammardef-strict-dynamic①"><code>'strict-dynamic'</code></a>"</p>
          <li data-md>
           <p><var>expression</var> matches either the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source①"><code>host-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source④"><code>scheme-source</code></a> grammar, <var>name</var> is "<code>script-src</code>", amd <var>list</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①②">contains</a> the token "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic" id="ref-for-grammardef-strict-dynamic②"><code>'strict-dynamic'</code></a>"</p>
          <li data-md>
           <p><var>name</var> is "<code>plugin-types</code>", and <var>expression</var> does not match the <a data-link-type="grammar"><code>media-type</code></a> grammar</p>
         </ul>
        <li data-md>
         <p>If <var>expression</var> is the U+002A ASTERISK character (<code>*</code>):</p>
         <ol>
          <li data-md>
           <p>For each <var>scheme</var> in « "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>" »:</p>
           <ol>
            <li data-md>
             <p>Append <var>scheme</var> to <var>result</var>.</p>
           </ol>
          <li data-md>
           <p>Append the concatenation of <var>origin</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-scheme" id="ref-for-concept-origin-scheme">scheme</a> and "<code>:</code>" to <var>result</var>.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①①">Continue</a>.</p>
         </ol>
        <li data-md>
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source⑤">scheme-source</a> grammar:</p>
         <ol>
          <li data-md>
           <p>If <var>expression</var> is "<code>http:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①①">append</a> "<code>https:</code>" to <var>result</var>.</p>
          <li data-md>
           <p>If <var>expression</var> is "<code>ws:</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①②">append</a> "<code>wss:</code>" to <var>result</var>.</p>
         </ol>
        <li data-md>
         <p>If <var>expression</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source②">host-source</a> grammar:</p>
         <ol>
          <li data-md>
           <p>If <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part①">scheme-part</a> is "http", append the result of
  concatenating "https://", <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part">host-part</a>, <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part">port-part</a>, and <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part">path-part</a> to <var>result</var>.</p>
          <li data-md>
           <p>If <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part②">scheme-part</a> is "ws", append the result of
  concatenating "wss://", <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part①">host-part</a>, <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part①">port-part</a>, and <var>expression</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part①">path-part</a> to <var>result</var>.</p>
         </ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①③">Append</a> <var>expression</var> to <var>result</var>.</p>
       </ol>
      <li data-md>
       <p>If <var>result</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty③">is empty</a> or « 'strict-dynamic' », return « 'none' ».</p>
      <li data-md>
       <p>Return <var>result</var>.</p>
     </ol>
    </div>
    <div class="example" id="example-6e93f215">
     <a class="self-link" href="#example-6e93f215"></a> 
     <p>For any directive with origin <code>https://example.test/</code>:</p>
<pre>https: wss: 'none' 'self'
</pre>
     <p>The effective source list is "http: wss: https://example.test/". Note that
    "'none'" is not part of the effective source list because it has no effect
    when it is not the only source.</p>
     <p>For "<code>style-src</code>":</p>
<pre>http://example.com 'strict-dynamic' 'nonce-abc'
</pre>
     <p>The effective source list is "http://example.com 'nonce-abc'" since
    "'strict-dynamic'" is ignored in non-"<code>script-src</code>" directives.</p>
     <p>For "<code>script-src</code>":</p>
<pre>http://example.com 'strict-dynamic' 'nonce-abc'
</pre>
     <p>The effective source list is "'strict-dynamic' 'nonce-abc'" since
    "'strict-dynamic'" in "<code>script-src</code>" case does not honor host and scheme
    source expressions.</p>
    </div>
    <h5 class="heading settled" data-level="3.1.4.3" id="similarity-source-expressions"><span class="secno">3.1.4.3. </span><span class="content">Source Expression Similarity</span><a class="self-link" href="#similarity-source-expressions"></a></h5>
    <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression">source expression</a> (<var>A</var>) is said to be <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="source-expression-similar">source-expression similar</dfn> to
  another <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression①">source expression</a> (<var>B</var>) if the two expressions are <a data-link-type="dfn">case-sensitive</a> matches, or if the relevant parts of their grammar match (for example, in the case of <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source⑥"><code>scheme-source</code></a> expressions, the respective <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part③"><code>scheme-part</code></a>s
  must <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#scheme-part-match" id="ref-for-scheme-part-match"><code>scheme-part</code> match</a> in one direction or the other.</p>
    <p class="note" role="note"><span>Note:</span> This property is symmetric. That is if <var>A</var> is <a data-link-type="dfn" href="#source-expression-similar" id="ref-for-source-expression-similar">source-expression similar</a> to <var>B</var>,
  then <var>B</var> will be <a data-link-type="dfn" href="#source-expression-similar" id="ref-for-source-expression-similar①">source-expression similar</a> to <var>A</var>.</p>
    <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression②">source expression</a> has a <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport id="source-expression-wildcard-host">wildcard host</dfn> if the first character of the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression③">source expression</a>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part②"><code>host-part</code></a> is an U+002A ASTERISK
  character (<code>*</code>).</p>
    <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression④">source expression</a> has a <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport id="source-expression-wildcard-port">wildcard port</dfn> if the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part②"><code>port-part</code></a> of the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression⑤">source expression</a> is an U+002A
  ASTERISK character (<code>*</code>).</p>
    <ol class="algorithm">
     <li data-md>
      <p>If <var>A</var>’s grammar does not match <var>B</var>’s grammar, return "<code>Not Similar</code>".</p>
     <li data-md>
      <p>If <var>A</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source②"><code>keyword-source</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source④"><code>nonce-source</code></a>,
  or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source⑤"><code>hash-source</code></a> grammar:</p>
      <ol>
       <li data-md>
        <p>If <var>A</var> is a <a data-link-type="dfn">case-sensitive</a> match to <var>B</var>, return "<code>Similar</code>".</p>
       <li data-md>
        <p>Return "<code>Not Similar</code>".</p>
      </ol>
     <li data-md>
      <p>Let <var>scheme A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part④"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>scheme B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part⑤"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>If the <var>scheme A</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#scheme-part-match" id="ref-for-scheme-part-match①">scheme-part match</a> <var>scheme B</var>, and <var>scheme B</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#scheme-part-match" id="ref-for-scheme-part-match②">scheme-part match</a> <var>scheme A</var>, return "<code>Not Similar</code>".</p>
     <li data-md>
      <p>If <var>A</var> or <var>B</var> matches <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source⑦"><code>scheme-source</code></a> grammar, return "<code>Similar</code>".</p>
     <li data-md>
      <p>Let <var>host A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part③"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>host B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part④"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>port A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part③"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>port B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part④"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>path A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part②"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>path B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part③"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Return "<code>Not Similar</code>" if any of the following is true:</p>
      <ol>
       <li data-md>
        <p>Both <var>A</var> and <var>B</var> have a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host">wildcard host</a>, but <var>host A</var> is
  not an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive①">ASCII case-insensitive</a> match to <var>host B</var>.</p>
       <li data-md>
        <p>At most one of <var>A</var> and <var>B</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host①">wildcard host</a>, <var>host A</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#host-part-match" id="ref-for-host-part-match"><code>host-part</code> match</a> <var>host B</var>, and <var>host B</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#host-part-match" id="ref-for-host-part-match①"><code>host-part</code> match</a> <var>host A</var>.</p>
       <li data-md>
        <p>Neither <var>A</var> nor <var>B</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-port" id="ref-for-source-expression-wildcard-port">wildcard port</a>, <var>port A</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#port-part-match" id="ref-for-port-part-match"><code>port-part</code> match</a> <var>port B</var>, and <var>port B</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#port-part-match" id="ref-for-port-part-match①"><code>port-part</code> match</a> <var>port A</var>.</p>
       <li data-md>
        <p><var>path A</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#path-part-match" id="ref-for-path-part-match"><code>path-part</code> match</a> <var>path B</var>, and <var>path B</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#path-part-match" id="ref-for-path-part-match①"><code>path-part</code> match</a> <var>path A</var>.</p>
      </ol>
     <li data-md>
      <p>Return "<code>Similar</code>".</p>
    </ol>
    <div class="example" id="example-fc3c4fd1">
     <a class="self-link" href="#example-fc3c4fd1"></a> 
<pre>A = 'nonce-ch4hvvbHDpv7xCSvXCs3BrNggHdTzxUA'
B = 'nonce-ch4hvvbHDpv7xCSvXCs3BrNggHdTzxUA'
</pre>
     <p>Since both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source⑤"><code>nonce-source</code></a> grammar and <var>A</var> is a <a data-link-type="dfn">case-sensitive</a> match for <var>B</var>, <var>A</var> is similar to <var>B</var>.</p>
<pre>A = https://inner.example.com/foo/
B = http://*.example.com/foo/bar/
</pre>
     <p>Since <var>A</var> has a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host②">wildcard host</a>, it matches any
    subdomain which in this case is "inner" so that <var>A</var> is similar to <var>B</var>.</p>
<pre>A = http://*.example.com
B = https://example.com:*
</pre>
     <p>Even though <var>A</var> and <var>B</var>’s ports are different, <var>A</var> and <var>B</var> are similar
    because "http" matches both "http" and a more secure variant "https".</p>
<pre>A = http://example.com:80/page1/html
B = https://example.com:443/
</pre>
     <p>In both sources specified ports are defalt ports for the respective schemes
    and <var>B</var>’s path would match any path, <var>A</var> is similar to <var>B</var>.</p>
<pre>A = 'sha256-abc123'
B = 'sha512-cde456'
</pre>
     <p>Even though both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source⑥"><code>hash-source</code></a> grammar, <var>A</var> is not a <a data-link-type="dfn">case-sensitive</a> match for <var>B</var> because the hashes don’t match.</p>
<pre>A = http://example.com:80
B = http://example.com:334
</pre>
     <p>In this case, ports of <var>A</var> and <var>B</var> do not match so that the two sources are
    not similar .</p>
<pre>A = http://example.com/page.html
B = http://example.com/index.html
</pre>
     <p>The two sources are not similar because their paths do not match.</p>
    </div>
    <p class="issue" id="issue-b43dcb1b"><a class="self-link" href="#issue-b43dcb1b"></a> Move the remaining intersection algorithms into this section.</p>
    <h3 class="heading settled" data-level="3.2" id="subsumption"><span class="secno">3.2. </span><span class="content">Subsumption</span><a class="self-link" href="#subsumption"></a></h3>
    <p class="issue" id="issue-94e5cca5"><a class="self-link" href="#issue-94e5cca5"></a> Move all the subsumption algorithms into this section.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <h3 class="heading settled algorithm" data-algorithm="Is response to request blocked by context’s required CSP?" data-level="4.1" id="process-response"><span class="secno">4.1. </span><span class="content"> Is <var>response</var> to <var>request</var> blocked by <var>context</var>’s required CSP? </span><a class="self-link" href="#process-response"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> (<var>response</var>), a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> (<var>request</var>), and a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context④">browsing context</a> (<var>context</var>), this algorithm returns "<code>Allowed</code>" or
  "<code>Blocked</code>" as appropriate:</p>
    <ol class="algorithm">
     <li data-md>
      <p>Return "<code>Allowed</code>" if either of the following is true:</p>
      <ol>
       <li data-md>
        <p><var>context</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context②">nested browsing context</a>.</p>
       <li data-md>
        <p><var>context</var>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp⑨">required CSP</a> is <code>null</code>.</p>
      </ol>
     <li data-md>
      <p>Let <var>required policy</var> be the result of executing <a href="https://www.w3.org/TR/CSP3/#parse-serialized-policy">Content Security Policy §2.2.1 Parse a serialized CSP</a> on <var>context</var>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp①⓪">required CSP</a> and
  "<code>enforce</code>".</p>
     <li data-md>
      <p>If the <a href="#origin-allowed">§ 4.2 Does response allow blanket enforcement of policy from request?</a> algorithm returns "<code>Allowed</code>" when executed upon <var>response</var> and <var>request</var>:</p>
      <ol>
       <li data-md>
        <p>Append <var>required policy</var> to <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list" id="ref-for-concept-response-csp-list">CSP
  list</a>.</p>
       <li data-md>
        <p>Return "<code>Allowed</code>".</p>
      </ol>
     <li data-md>
      <p class="assertion">Assert: <var>context</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context③">nested browsing context</a>, and <var>response</var> is
  a cross-origin, <a data-link-type="dfn">network schemed</a> resource.</p>
     <li data-md>
      <p>If the <a href="#subsume-policy-list">§ 4.3 Does subsuming policy subsume policy list given their respective
    origins?</a> algorithm returns "<code>Subsumes</code>" when
  executed upon <var>required policy</var>, <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a>, <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list" id="ref-for-concept-response-csp-list①">CSP list</a>, and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>, return "<code>Allowed</code>".</p>
     <li data-md>
      <p>Return "<code>Blocked</code>".</p>
    </ol>
    <h3 class="heading settled algorithm" data-algorithm="Does response allow blanket enforcement of policy from request?" data-level="4.2" id="origin-allowed"><span class="secno">4.2. </span><span class="content"> Does <var>response</var> allow blanket enforcement of policy from <var>request</var>? </span><a class="self-link" href="#origin-allowed"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a> (<var>response</var>), and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> (<var>request</var>), this
  algorithm returns "<code>Allowed</code>" if the former allows the latter to enforce
  arbitrary policy, and "<code>Not Allowed</code>" otherwise:</p>
    <ol>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url①">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is
  a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#local-scheme" id="ref-for-local-scheme">local scheme</a>, return "<code>Allowed</code>".</p>
      <p class="note" role="note"><span>Note:</span> The embedder has direct access to same-origin responses, so if it
  wishes to enforce a policy on that same-origin response, we simply do so.</p>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url②">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> is the
  same as <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin①">origin</a>, return "<code>Allowed</code>".</p>
      <p class="note" role="note"><span>Note:</span> Likewise, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#local-scheme" id="ref-for-local-scheme①">local scheme</a> responses already inherit their policy
  from the embedder, so we allow the embedder to tighten that policy via this
  embedding mechanism.</p>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a> has a header named <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from⑥"><code>Allow-CSP-From</code></a> (<var>header</var>):</p>
      <ol>
       <li data-md>
        <p>If <var>header</var>’s value is "<code>*</code>", return "<code>Allowed</code>".</p>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin②">origin</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode" id="ref-for-utf-8-encode">UTF-8
  encoded</a> is <var>header</var>’s value, return "<code>Allowed</code>".</p>
      </ol>
     <li data-md>
      <p>Return "<code>Not Allowed</code>".</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B?" data-level="4.2.1" id="intersection-source-expressions"><span class="secno">4.2.1. </span><span class="content"> What is an intersection of two expressions matching <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source⑧"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source③"><code>host-source</code></a> grammar <var>A</var> and <var>B</var>? </span><a class="self-link" href="#intersection-source-expressions"></a></h4>
    <p><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression⑥">Source expression</a> is said to be an <dfn class="dfn-paneled" data-dfn-for="source expression" data-dfn-type="dfn" data-noexport id="source-expression-intersection">intersection</dfn> of two other
  expressions matching <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source⑨"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source④"><code>host-source</code></a> grammar <var>A</var> and <var>B</var> if it contains the more
  restrictive <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part⑥"><code>scheme-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part⑤"><code>host-part</code></a>, <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part⑤"><code>port-part</code></a>, and <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part④"><code>path-part</code></a> of the two.</p>
    <div class="example" id="example-b67e239e">
     <a class="self-link" href="#example-b67e239e"></a> In these cases, <code>Intersect</code> is an <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection①">intersection</a> for <var>A</var> and <var>B</var>. 
<pre>A = https:
B = http:
Intersect = https:
</pre>
<pre>A = http://*.example.com
B = https://example.com:*
Intersect = https://example.com:443
</pre>
<pre>A = http://example.com:80/page1/html
B = https://example.com:443/
Intersect = https://example.com:443/page1/html
</pre>
<pre>A = https:
B = http://example.com
Intersect = <code>https://example.com</code>.
</pre>
<pre>A = https://example.com:*
B = http://*.example.com/page.html
Intersect = <code>https://example.com/page.html</code>
</pre>
    </div>
    <p>Given two expressions matching the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⓪"><code>scheme-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source⑤"><code>host-source</code></a> grammar (<var>A</var> and <var>B</var>), return their <a data-link-type="dfn" href="#source-expression-intersection" id="ref-for-source-expression-intersection②">intersection</a> if <var>A</var> is <a data-link-type="dfn" href="#source-expression-similar" id="ref-for-source-expression-similar②">source-expression similar</a> to <var>B</var>.
  Otherwise, return <code>null</code>.</p>
    <ol>
     <li data-md>
      <p>If <var>A</var> is not <a data-link-type="dfn" href="#source-expression-similar" id="ref-for-source-expression-similar③">source-expression similar</a> to <var>B</var>, return <code>null</code>.</p>
     <li data-md>
      <p>Let <var>source</var> be an empty string.</p>
     <li data-md>
      <p>Let <var>scheme A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part⑦"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>scheme B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part⑧"><code>scheme-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>more secure scheme B</var> be <code>true</code> if <var>scheme A</var> does not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#scheme-part-match" id="ref-for-scheme-part-match③"><code>scheme-part</code> match</a> <var>scheme B</var>, and <code>false</code> otherwise.</p>
     <li data-md>
      <p>Append <var>scheme A</var> and ":" to <var>source</var> if <var>scheme A</var> is not <code>null</code> and <var>more secure scheme B</var> is <code>false</code>. Otherwise, append <var>scheme B</var> and ":"
  to <var>source</var> if <var>scheme B</var> is not <code>null</code>.</p>
     <li data-md>
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①①"><code>scheme-source</code></a> grammar,
  return <var>source</var>.</p>
     <li data-md>
      <p>Append "//" to <var>source</var> if it is not empty.</p>
     <li data-md>
      <p>Let <var>host A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part⑥"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>host B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part⑦"><code>host-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>If <var>host A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md>
        <p>If <var>host B</var> is <code>null</code>, append <var>host A</var> to <var>source</var>.
   Continue to the next step in the main algorithm.</p>
       <li data-md>
        <p>If <var>A</var> doesn’t match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①②"><code>scheme-source</code></a> grammar and
   doesn’t have a <a data-link-type="dfn" href="#source-expression-wildcard-host" id="ref-for-source-expression-wildcard-host③">wildcard host</a>, append <var>host A</var> to <var>source</var>.</p>
       <li data-md>
        <p>Otherwise, append <var>host B</var> to <var>source</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>host A</var> is <code>null</code>, append <var>host B</var> to <var>source</var>.</p>
     <li data-md>
      <p>Let <var>port A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part⑥"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>port B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part⑦"><code>port-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>If <var>port A</var> is <code>null</code>, append ":" and <var>port B</var> to <var>source</var> if it is
   not <code>null</code>.</p>
     <li data-md>
      <p>If <var>port A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md>
        <p>If <var>port B</var> is <code>null</code>, append ":" and <var>port A</var> to <var>source</var>.
   Continue to the next step in the main algorithm.</p>
       <li data-md>
        <p>If <var>A</var> doesn’t have a <a data-link-type="dfn" href="#source-expression-wildcard-port" id="ref-for-source-expression-wildcard-port①">wildcard port</a> and <var>more secure scheme B</var> is <code>false</code>, append ":" and <var>port A</var> to <var>source</var>.</p>
       <li data-md>
        <p>Otherwise, append ":" and <var>port B</var> to <var>source</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>path A</var> be <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part⑤"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>Let <var>path B</var> be <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part⑥"><code>path-part</code></a>, if present, and <code>null</code> otherwise.</p>
     <li data-md>
      <p>If <var>path A</var> is <code>null</code>, append <var>path B</var> to <var>source</var> if it is not <code>null</code>.</p>
     <li data-md>
      <p>If <var>path A</var> is not <code>null</code>:</p>
      <ol>
       <li data-md>
        <p>If <var>path B</var> is <code>null</code>, return the result of appending <var>path A</var> to <var>source</var>.</p>
       <li data-md>
        <p>If <var>path A</var> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#path-part-match" id="ref-for-path-part-match②"><code>path-part</code> matches</a> <var>path B</var>, append <var>path A</var> to <var>source</var>.</p>
       <li data-md>
        <p>Otherwise, append <var>path B</var> to <var>source</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>source</var>.</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Rewrite &apos;self&apos; into a host-source expression for origin." data-level="4.2.2" id="rewrite-self"><span class="secno">4.2.2. </span><span class="content"> Rewrite <code>'self'</code> into a host-source expression for <var>origin</var>. </span><a class="self-link" href="#rewrite-self"></a></h4>
    <p>Given an origin (<var>origin</var>), this algorithm returns a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source⑥"><code>host-source</code></a> expression that has the same effect
  as <code>'self'</code> for that origin:</p>
    <ol>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>, return the empty string.</p>
     <li data-md>
      <p>Return the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">ASCII
  serialization</a> of <var>origin</var>.</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Does source expression A subsume source expression B?" data-level="4.2.3" id="subsume-source-expressions"><span class="secno">4.2.3. </span><span class="content"> Does <code>source expression</code> <var>A</var> subsume <code>source expression</code> <var>B</var>? </span><a class="self-link" href="#subsume-source-expressions"></a></h4>
    <p>Given two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression⑦">source expressions</a> <var>A</var> and <var>B</var>, this algorithm returns
  "<code>Subsumes</code>" if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume④">subsumes</a> <var>B</var>, and returns
  "<code>Does Not Subsume</code>" otherwise.</p>
    <ol>
     <li data-md>
      <p class="assertion">Assert: Neither <var>A</var> nor <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source③"><code>keyword-source</code></a> grammar.</p>
     <li data-md>
      <p>If both <var>A</var> and <var>B</var> match either <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source⑦"><code>host-source</code></a> or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①③"><code>scheme-source</code></a> grammar:</p>
      <ol>
       <li data-md>
        <p>If <a href="https://www.w3.org/TR/CSP3/#match-schemes">Content Security Policy §6.6.2.7 scheme-part matching</a> returns "<code>Does Not Match</code>" given <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part⑨"><code>scheme-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part①⓪"><code>scheme-part</code></a>) and <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part①①"><code>scheme-part</code></a> (or <code>null</code> if <var>B</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part" id="ref-for-grammardef-scheme-part①②"><code>scheme-part</code></a>),
  return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <var>A</var> or <var>B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①④"><code>scheme-source</code></a> grammar:</p>
        <ol>
         <li data-md>
          <p>If <var>A</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⑤"><code>scheme-source</code></a> grammar, return
  "<code>Subsumes</code>". Otherwise, return "<code>Does Not Subsume</code>".</p>
        </ol>
       <li data-md>
        <p>If <var>B</var> has a <code>wildcard host</code>:</p>
        <ol>
         <li data-md>
          <p>If <var>A</var> doesn’t have a <code>wildcard host</code>, return "<code>Does not Subsume</code>".</p>
         <li data-md>
          <p>Let <var>remaining host B</var> be the result of removing the leading
  ("*.") from <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part⑧"><code>host-part</code></a>.</p>
         <li data-md>
          <p>If <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy §6.6.2.8 host-part matching</a> returns "<code>Does Not Match</code>" given <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part⑨"><code>host-part</code></a> and <var>remaining host B</var>, return
  "<code>Does Not Subsume</code>".</p>
        </ol>
       <li data-md>
        <p>If <var>B</var> doesn’t have a <code>wildcard host</code> and <a href="https://www.w3.org/TR/CSP3/#match-hosts">Content Security Policy §6.6.2.8 host-part matching</a> returns
  "<code>Does Not Match</code>" given <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part①⓪"><code>host-part</code></a> and <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-part" id="ref-for-grammardef-host-part①①"><code>host-part</code></a>, return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <var>A</var> has a <code>wildcard port</code> but <var>B</var> doesn’t have a <code>wildcard port</code>,
  return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <var>A</var> doesn’t have a <code>wildcard port</code> and <a href="https://www.w3.org/TR/CSP3/#match-ports">Content Security Policy §6.6.2.9 port-part matching</a> returns
  "<code>Does Not Match</code>" given <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part⑧"><code>port-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part⑨"><code>port-part</code></a>)
  and <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part①⓪"><code>port-part</code></a> (or <code>null</code> if <var>B</var> does not
  contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-port-part" id="ref-for-grammardef-port-part①①"><code>port-part</code></a>), return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <a href="https://www.w3.org/TR/CSP3/#match-paths">Content Security Policy §6.6.2.10 path-part matching</a> returns "<code>Does Not Match</code>" given <var>A</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part⑦"><code>path-part</code></a> (or <code>null</code> if <var>A</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part⑧"><code>path-part</code></a>) and <var>B</var>’s <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part⑨"><code>path-part</code></a> (or <code>null</code> if <var>B</var> does not contain a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-path-part" id="ref-for-grammardef-path-part①⓪"><code>path-part</code></a>), return
  "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
     <li data-md>
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source⑦"><code>hash-source</code></a> grammar:</p>
      <ol>
       <li data-md>
        <p>If <var>A</var> is a <a data-link-type="dfn">case-sensitive</a> match to <var>B</var>, return "<code>Subsumes</code>".
  Otherwise, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md>
      <p>If both <var>A</var> and <var>B</var> match the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source⑥"><code>nonce-source</code></a> grammar:</p>
      <ol>
       <li data-md>
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
      <p class="note" role="note"><span>Note:</span> Nonce source matching is value-agnostic to prevent a malicious
  embedder from brute forcing the nonce value with an attack as
  described in <a href="#policy-leakage">§ 5.2 Policy Leakage</a></p>
     <li data-md>
      <p>Return "<code>Does Not Subsume</code>".</p>
    </ol>
    <h4 class="heading settled algorithm" data-algorithm="Does source list A subsume source listB given their
    respective origins and directive names?" data-level="4.2.4" id="subsume-source-list"><span class="secno">4.2.4. </span><span class="content"> Does <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists⑨">source list</a> <var>A</var> subsume <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists①⓪">source list</a><var>B</var> given their
    respective <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin③">origins</a> and directive names? </span><a class="self-link" href="#subsume-source-list"></a></h4>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists①①">source list</a> <var>A</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin④">origin</a> (<var>origin A</var>) and a string (<var>directive A</var>), <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists①②">source list</a> <var>B</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin⑤">origin</a> (<var>origin B</var>) and a string (<var>directive B</var>), this
  algorithm returns "<code>Subsumes</code>" if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume⑤">subsumes</a> <var>B</var>, and
  returns "<code>Does Not Subsume</code>" otherwise.</p>
    <p>A <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives" id="ref-for-directives①⑤">directive</a> <dfn class="dfn-paneled" data-dfn-for="directive" data-dfn-type="dfn" data-noexport id="directive-contains">contains</dfn> a given <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-expression" id="ref-for-source-expression⑧">source expression</a> if the expression is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①③">contained</a> by
  its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①⑦">value</a>.</p>
    <ol>
     <li data-md>
      <p>If <var>directive A</var> is not an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive②">ASCII case-insensitive</a> match to <var>directive B</var>, return "<code>Does Not Subsume</code>".</p>
     <li data-md>
      <p>If <var>A</var> is empty or <var>B</var> is <code>none</code>, return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>If <var>B</var> is empty or <var>A</var> is <code>none</code>, return "<code>Does Not Subsume</code>".</p>
     <li data-md>
      <p>If <var>directive B</var> is "<code>script-src</code>" and <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source④"><code>keyword-source</code></a> expression "<code>strict-dynamic</code>" but <var>A</var> does not contain it, return "<code>Does Not Subsume</code>".</p>
     <li data-md>
      <p>If <var>directive B</var> is "<code>script-src</code>" or "<code>style-src</code>":</p>
      <ol>
       <li data-md>
        <p>If <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains①">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source⑤"><code>keyword-source</code></a> expression "<code>unsafe-eval</code>" but <var>A</var> does not contain it, return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <var>B</var> <a data-link-type="dfn" href="#directive-contains" id="ref-for-directive-contains②">contains</a> a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source⑥"><code>keyword-source</code></a> expression
  "<code>unsafe-hashed-attributes</code>" but <var>A</var> does not contain it, return
  "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>Let <var>type B</var> be "<code>script</code>" if <var>directive B</var> is "<code>script-src</code>" and
  "<code>style</code>" otherwise. Similarly, let <var>type A</var> be "<code>script</code>" if <var>directive A</var> is "<code>script-src</code>" and "<code>style</code>" otherwise.</p>
       <li data-md>
        <p>If <a href="https://www.w3.org/TR/CSP3/#allow-all-inline">Content Security Policy §6.6.3.2 Does a source list allow all inline behavior for type?</a> returns "<code>Allows</code>" given <var>B</var> with <var>type B</var>, but returns "<code>Does Not Allow</code>" given <var>A</var> with <var>type A</var>, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md>
      <p>Let <var>list A</var> and <var>list B</var> be empty lists.</p>
     <li data-md>
      <p>For each <var>expression A</var> in <var>A</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>expression A</var> is "<code>self</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source⑧"><code>host-source</code></a>,
  returned by <a href="#rewrite-self">§ 4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin A</var> to <var>list A</var>.</p>
       <li data-md>
        <p>If <var>expression A</var> matches the U+002A ASTERISK character (<code>*</code>),
   append to <var>list A</var> the following <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⑥"><code>scheme-source</code></a> expressions: "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>",
   and <var>origin A</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-scheme" id="ref-for-concept-origin-scheme①">scheme</a>.</p>
        <ol>
         <li data-md>
          <p>If <var>directive A</var> is either "<code>img-src</code>" or "<code>media-src</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⑦"><code>scheme-source</code></a> expression "<code>data:</code>" to <var>list A</var>.</p>
         <li data-md>
          <p>If <var>directive A</var> is "<code>media-src</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⑧"><code>scheme-source</code></a> expression "<code>blob:</code>" to <var>list A</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①②">Continue</a> to the next <var>expression A</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>expression A</var> does not match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source⑦"><code>keyword-source</code></a> grammar, append <var>expression A</var> to <var>list A</var>.</p>
      </ol>
     <li data-md>
      <p>For each <var>expression B</var> in <var>B</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>expression B</var> is "<code>self</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-host-source" id="ref-for-grammardef-host-source⑨"><code>host-source</code></a>,
  returned by <a href="#rewrite-self">§ 4.2.2 Rewrite 'self' into a host-source expression for origin.</a> given <var>origin B</var> to <var>list B</var>.</p>
       <li data-md>
        <p>If <var>expression B</var> matches the U+002A ASTERISK character (<code>*</code>),
  append to <var>list B</var> the following <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source①⑨"><code>scheme-source</code></a> expressions: "<code>ftp:</code>", "<code>http:</code>", "<code>https:</code>", "<code>ws:</code>", "<code>wss:</code>",
  and <var>origin B</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-scheme" id="ref-for-concept-origin-scheme②">scheme</a>.</p>
        <ol>
         <li data-md>
          <p>If <var>directive B</var> is either "<code>img-src</code>" or "<code>media-src</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source②⓪"><code>scheme-source</code></a> expression "<code>data:</code>" to <var>list B</var>.</p>
         <li data-md>
          <p>If <var>directive B</var> is "<code>media-src</code>", append a <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source" id="ref-for-grammardef-scheme-source②①"><code>scheme-source</code></a> expression "<code>blob:</code>" to <var>list B</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①③">Continue</a> to the next <var>expression B</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>expression B</var> does not match <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source" id="ref-for-grammardef-keyword-source⑧"><code>keyword-source</code></a> grammar, append <var>expression B</var> to <var>list B</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>list B</var> is empty, return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>If <var>list A</var> is empty, return "<code>Does Not Subsume</code>".</p>
     <li data-md>
      <p>For each <var>expression B</var> in <var>list B</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>expression B</var> matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source⑧"><code>hash-source</code></a> gramar, or <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source" id="ref-for-grammardef-nonce-source⑦"><code>nonce-source</code></a> grammar, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①④">continue</a> to the next expression unless <var>directive A</var> is "<code>script-src</code>" or
  "<code>style-src</code>".</p>
       <li data-md>
        <p>Let <var>found match</var> be <code>false</code>.</p>
       <li data-md>
        <p>For each <var>expression A</var> in <var>list A</var>:</p>
        <ol>
         <li data-md>
          <p>If <a href="#subsume-source-expressions">§ 4.2.3 Does source expression A subsume source expression B?</a> returns "<code>Subsumes</code>" given <var>expression A</var> and <var>expression B</var>, set <var>found match</var> to <code>true</code>.
  Break out of this inner loop.</p>
        </ol>
       <li data-md>
        <p>If <var>found match</var> is <code>false</code>, return "<code>Does Not Subsume</code>".</p>
      </ol>
     <li data-md>
      <p>Return "<code>Subsumes</code>".</p>
    </ol>
    <div class="example" id="example-2404365b">
     <a class="self-link" href="#example-2404365b"></a> Let <var>directive A</var> and <var>directive B</var> be "<code>script-src</code>". Consider
    the following examples: 
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com"
</pre>
     <p>Since <var>B</var> does not allow <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source" id="ref-for-grammardef-hash-source⑨"><code>hash-source</code></a> expressions, but its
    value is found in <var>A</var>, <var>A</var> subsumes <var>B</var>. It is, however, not true that <var>B</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume⑥">subsumes</a> <var>A</var>.</p>
<pre>A = "https://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com"
</pre>
     <p>In this case, <var>A</var> does not subsume <var>B</var> since "https://example.com" does
    not <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume⑦">subsume</a> "http://example.com".</p>
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8'"
B = "http://example.com 'unsafe-inline'"
</pre>
     <p>Since <var>B</var> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior" id="ref-for-source-list-allows-all-inline-behavior">allows all inline behavior</a>,
    but <var>A</var> does not, <var>A</var> doesn’t <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume⑧">subsume</a> <var>B</var>.</p>
<pre>A = "http://example.com 'sha256-xzi4zkCjuC8' 'strict-dynamic'"
B = "http://example.com 'unsafe-inline' 'strict-dynamic'"
</pre>
     <p>Neither <var>A</var> nor <var>B</var> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior" id="ref-for-source-list-allows-all-inline-behavior①">allows all inline behavior</a>.
    In this case, <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume⑨">subsumes</a> <var>B</var>.</p>
    </div>
    <h4 class="heading settled algorithm" data-algorithm="Does policy A subsume policy B given their respective
    origins?" data-level="4.2.5" id="subsume-policy"><span class="secno">4.2.5. </span><span class="content"> Does <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy④">policy</a> <var>A</var> subsume <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑤">policy</a> <var>B</var> given their respective <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin⑥">origins</a>? </span><a class="self-link" href="#subsume-policy"></a></h4>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑥">policy</a> <var>A</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin⑦">origin</a> (<var>origin A</var>) and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑦">policy</a> <var>B</var> with an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin⑧">origin</a> (<var>origin B</var>), this algorithm returns "<code>Subsumes</code>"
  if <var>A</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume①⓪">subsumes</a> <var>B</var>, and returns "<code>Does Not Subsume</code>"
  otherwise.</p>
    <ol>
     <li data-md>
      <p>If <var>A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①④">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty④">is empty</a>,
  return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>For each <var>directive A</var> in <var>A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①⑤">directive set</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>directive name</var> be <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①②">name</a>.</p>
       <li data-md>
        <p>If <var>directive name</var> is "<code>default-src</code>", "<code>report-uri</code>", "<code>report-to</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⑤">continue</a>.</p>
       <li data-md>
        <p>Let <var>effective directive A</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value②">effective directive value</a> for <var>directive name</var> and <var>A</var>.</p>
       <li data-md>
        <p>Let <var>effective directive B</var> be the <a data-link-type="dfn" href="#effective-directive-value" id="ref-for-effective-directive-value③">effective directive value</a> for <var>directive name</var> and <var>B</var>.</p>
       <li data-md>
        <p>If <var>effective directive A</var> is <code>null</code>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⑥">continue</a>.</p>
       <li data-md>
        <p>If <var>effective directive B</var> is <code>null</code>, return "<code>Does Not Subsume</code>".</p>
       <li data-md>
        <p>If <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①③">name</a> is "<code>frame-ancestors</code>":</p>
        <ol>
         <li data-md>
          <p class="issue" id="issue-95f2d23a"><a class="self-link" href="#issue-95f2d23a"></a> TODO.</p>
        </ol>
       <li data-md>
        <p>If <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①④">name</a> is "<code>plugin-types</code>":</p>
        <ol>
         <li data-md>
          <p class="issue" id="issue-95f2d23a①"><a class="self-link" href="#issue-95f2d23a①"></a> TODO.</p>
        </ol>
       <li data-md>
        <p>If <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①⑤">name</a> is "<code>sandbox</code>":</p>
        <ol>
         <li data-md>
          <p class="issue" id="issue-95f2d23a②"><a class="self-link" href="#issue-95f2d23a②"></a> TODO.</p>
        </ol>
       <li data-md>
        <p>If <var>directive A</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name" id="ref-for-directive-name①⑥">name</a> is "<code>disown-opener</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⑦">continue</a>.</p>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>If the result of executing <a href="#subsume-source-list">§ 4.2.4 Does source list A subsume source listB given their
    respective origins and directive names?</a> is
  "<code>Does Not Subsume</code>" given <var>effective directive A</var>, <var>origin A</var>, <var>directive name</var>, <var>effective directive B</var>, <var>origin B</var>, and <var>directive name</var>, return "<code>Does Not Subsume</code>".</p>
        </ol>
      </ol>
      <ol start="3">
       <li data-md>
        <p>Return "<code>Subsumes</code>".</p>
      </ol>
    </ol>
    <h3 class="heading settled algorithm" data-algorithm="Does subsuming policy subsume policy list given their respective
    origins?" data-level="4.3" id="subsume-policy-list"><span class="secno">4.3. </span><span class="content"> Does <var>subsuming policy</var> subsume <var>policy list</var> given their respective <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin④">origins</a>? </span><a class="self-link" href="#subsume-policy-list"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑧">policy</a> <var>subsuming policy</var> with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin⑤">origin</a> (<var>subsuming origin</var>) and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#violation-policy" id="ref-for-violation-policy⑨">policy</a> objects <var>policy list</var> with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin⑥">origin</a> (<var>origin</var>), this algorithm returns "<code>Subsumes</code>"
  if <var>subsuming policy</var> <a data-link-type="dfn" href="#policy-subsume" id="ref-for-policy-subsume①①">subsumes</a> <var>policy list</var>, and returns
  "<code>Does Not Subsume</code>" otherwise.</p>
    <ol class="algorithm">
     <li data-md>
      <p>If <var>subsuming policy</var> is <code>null</code>, return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>If <var>subsuming policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition" id="ref-for-policy-disposition③">disposition</a> is "<code>report</code>",
  return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>If <var>subsuming policy</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set" id="ref-for-policy-directive-set①⑥">directive set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty⑤">is empty</a>, return "<code>Subsumes</code>".</p>
     <li data-md>
      <p>If <var>policy list</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty⑥">is empty</a> or <code>null</code>, return
  "<code>Does Not Subsume</code>".</p>
     <li data-md>
      <p>Let <var>effective policy</var> the result of executing <a href="#intersection-policy-list">§ 3.1.1 CSP List intersection</a> given <var>policy list</var> and <var>origin</var>.</p>
     <li data-md>
      <p>Return the result of executing <a href="#subsume-policy">§ 4.2.5 Does policy A subsume policy B given their respective
    origins?</a> given <var>subsuming policy</var>, <var>subsuming origin</var>, <var>effective policy</var>, and <var>origin</var>.</p>
    </ol>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="security-and-privacy-considerations"><span class="secno">5. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#security-and-privacy-considerations"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="policy-enforcement"><span class="secno">5.1. </span><span class="content">Policy Enforcement</span><a class="self-link" href="#policy-enforcement"></a></h3>
    <p>Embedded documents should be careful to evaluate the proposed Content Security
  Policy, and not simply to reflect whatever policy an embedder suggests. Doing
  so may enable a clever attacker to selectively disable pieces of a website’s
  code which are essential for its own protection.</p>
    <p>In particular, documents which do not expect to be embedded should continue to
  respond to any such request with a Content Security Policy containing an
  appropriate <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors" id="ref-for-frame-ancestors"><code>frame-ancestors</code></a> directive.</p>
    <h3 class="heading settled" data-level="5.2" id="policy-leakage"><span class="secno">5.2. </span><span class="content">Policy Leakage</span><a class="self-link" href="#policy-leakage"></a></h3>
    <p>The enforcement mechanism allows a malicious embedder to read a page’s policy
  cross-origin by brute-forcing its constraints. This could leak interesting
  data about the page or the user loading the page if the policy contains secret
  tokens or usernames.</p>
    <p>Again, the best defense here is to control the contexts allowed to embed a
  given resource via an appropriate <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#frame-ancestors" id="ref-for-frame-ancestors①"><code>frame-ancestors</code></a> directive.</p>
    <h3 class="heading settled" data-level="5.3" id="exfiltration"><span class="secno">5.3. </span><span class="content">Data Exfiltration</span><a class="self-link" href="#exfiltration"></a></h3>
    <p>This feature allows an embedder to send information to a third-party endpoint
  via the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp⑦"><code>Sec-Required-CSP</code></a> HTTP header. This doesn’t seem to
  expose any information that couldn’t be tunneled in the HTTP request itself
  (via GET parameters, etc), and embedders remain in control over the endpoints
  to which such requests may be made by enforcing a Content Security Policy with
  an appropriate <code>child-src</code> directive.</p>
    <h3 class="heading settled" data-level="5.4" id="header-injection"><span class="secno">5.4. </span><span class="content">Header Injection</span><a class="self-link" href="#header-injection"></a></h3>
    <p class="issue" id="issue-56722a75"><a class="self-link" href="#issue-56722a75"></a> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.</p>
    <h3 class="heading settled" data-level="5.5" id="header-reflection"><span class="secno">5.5. </span><span class="content">Header Reflection</span><a class="self-link" href="#header-reflection"></a></h3>
    <p class="issue" id="issue-56722a75①"><a class="self-link" href="#issue-56722a75①"></a> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="authoring-considerations"><span class="secno">6. </span><span class="content">Authoring Considerations</span><a class="self-link" href="#authoring-considerations"></a></h2>
    <h3 class="heading settled" data-level="6.1" id="effect-self"><span class="secno">6.1. </span><span class="content"> Requiring <code>'self'</code> </span><a class="self-link" href="#effect-self"></a></h3>
    <p>When processing a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context⑤">browsing context</a>’s <a data-link-type="dfn" href="#browsing-context-required-csp" id="ref-for-browsing-context-required-csp①①">required CSP</a>, the
  keyword <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self②"><code>'self'</code></a> refers to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin⑦">origin</a> of the URL being loaded
  into the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context④">nested browsing context</a>, not to the origin of the document in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context" id="ref-for-source-browsing-context">source
  browsing context</a>.</p>
    <div class="example" id="example-91f8a592">
     <a class="self-link" href="#example-91f8a592"></a> MegaCorp Inc. requires a policy containing <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-self" id="ref-for-grammardef-self③"><code>'self'</code></a> on their page at <code>https://example.com/page.html</code>: 
<pre>&lt;iframe src="https://advertisements-r-us.example.com/ad1.cfm"
        <a data-link-type="element-attr" href="#element-attrdef-iframe-csp" id="ref-for-element-attrdef-iframe-csp①②">csp</a>="script-src 'self'">
&lt;/iframe>
</pre>
     <p>If the returned CSP is:</p>
<pre>Content-Security-Policy: script-src 'self'
</pre>
     <p>Then this <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element⑨">iframe</a></code> element will be loaded.</p>
     <p>If, however, the returned CSP is:</p>
<pre>Content-Security-Policy: script-src "https://example.com/"
</pre>
     <p>Then this <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①⓪">iframe</a></code> element will not be loaded.</p>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="iana"><span class="secno">7. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana"></a></h2>
    <p>The permanent message header field registry should be updated
  with the following registration for the <a data-link-type="http-header" href="#http-headerdef-sec-required-csp" id="ref-for-http-headerdef-sec-required-csp⑧"><code>Sec-Required-CSP</code></a> header: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>
    <dl>
     <dt data-md>Header field name
     <dd data-md>
      <p>Sec-Required-CSP</p>
     <dt data-md>Applicable protocol
     <dd data-md>
      <p>http</p>
     <dt data-md>Status
     <dd data-md>
      <p>standard</p>
     <dt data-md>Author/Change controller
     <dd data-md>
      <p>W3C</p>
     <dt data-md>Specification document
     <dd data-md>
      <p>This specification (See <a href="#required-csp-header">§ 2.2 The Sec-Required-CSP HTTP Request Header</a>)</p>
    </dl>
    <p>Likewise, the registry should be updated with the following registration
  for the <a data-link-type="http-header" href="#http-headerdef-allow-csp-from" id="ref-for-http-headerdef-allow-csp-from⑦"><code>Allow-CSP-From</code></a> header: <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a></p>
    <dl>
     <dt data-md>Header field name
     <dd data-md>
      <p>Allow-CSP-From</p>
     <dt data-md>Applicable protocol
     <dd data-md>
      <p>http</p>
     <dt data-md>Status
     <dd data-md>
      <p>standard</p>
     <dt data-md>Author/Change controller
     <dd data-md>
      <p>W3C</p>
     <dt data-md>Specification document
     <dd data-md>
      <p>This specification (See <a href="#allow-csp-from-header">§ 2.3 The Allow-CSP-From HTTP Response Header</a>)</p>
    </dl>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-ae2b6bc0">
   <a class="self-link" href="#example-ae2b6bc0"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#http-headerdef-allow-csp-from">Allow-CSP-From</a><span>, in §2.3</span>
   <li><a href="#directive-contains">contains</a><span>, in §4.2.4</span>
   <li>
    csp
    <ul>
     <li><a href="#dom-htmliframeelement-csp">attribute for HTMLIFrameElement</a><span>, in §2.1</span>
     <li><a href="#element-attrdef-iframe-csp">element-attr for iframe</a><span>, in §2.1</span>
    </ul>
   <li><a href="#effective-directive-value">effective directive value</a><span>, in §3.1.4.1</span>
   <li><a href="#effective-source-list">effective source list</a><span>, in §3.1.4.2</span>
   <li>
    intersection
    <ul>
     <li><a href="#csp-list-intersection">dfn for CSP list</a><span>, in §3.1.1</span>
     <li><a href="#content-security-policy-object-intersection">dfn for content security policy object</a><span>, in §3.1.2</span>
     <li><a href="#source-expression-intersection">dfn for source expression</a><span>, in §4.2.1</span>
     <li><a href="#source-list-intersection">dfn for source list</a><span>, in §3.1.3</span>
    </ul>
   <li><a href="#browsing-context-required-csp">required CSP</a><span>, in §2.4.1</span>
   <li><a href="#http-headerdef-sec-required-csp">Sec-Required-CSP</a><span>, in §2.2</span>
   <li><a href="#abstract-opdef-set-the-sec-required-csp-header">set-required-csp</a><span>, in §2.2</span>
   <li><a href="#abstract-opdef-set-the-required-csp">set the required CSP</a><span>, in §2.4.1</span>
   <li><a href="#abstract-opdef-set-the-sec-required-csp-header">set the Sec-Required-CSP header</a><span>, in §2.2</span>
   <li><a href="#source-expression-similar">source-expression similar</a><span>, in §3.1.4.3</span>
   <li><a href="#policy-subsume">subsume</a><span>, in §3</span>
   <li><a href="#policy-subsumed-by">subsumed by</a><span>, in §3</span>
   <li><a href="#iframe-csp-valid-attribute-value">valid attribute value</a><span>, in §2.1</span>
   <li><a href="#source-expression-wildcard-host">wildcard host</a><span>, in §3.1.4.3</span>
   <li><a href="#source-expression-wildcard-port">wildcard port</a><span>, in §3.1.4.3</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-grammardef-none">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-none">https://w3c.github.io/webappsec-csp/#grammardef-none</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-none">3.1.3. Source List Intersection</a> <a href="#ref-for-grammardef-none①">(2)</a> <a href="#ref-for-grammardef-none②">(3)</a>
    <li><a href="#ref-for-grammardef-none③">3.1.4.2. Effective Source List</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-self">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-self">https://w3c.github.io/webappsec-csp/#grammardef-self</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-self">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-self①">(2)</a>
    <li><a href="#ref-for-grammardef-self②">6.1. 
    Requiring 'self' </a> <a href="#ref-for-grammardef-self③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-strict-dynamic">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic">https://w3c.github.io/webappsec-csp/#grammardef-strict-dynamic</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-strict-dynamic">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-strict-dynamic①">(2)</a> <a href="#ref-for-grammardef-strict-dynamic②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-unsafe-inline">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline">https://w3c.github.io/webappsec-csp/#grammardef-unsafe-inline</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-unsafe-inline">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-unsafe-inline①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-list-allows-all-inline-behavior">
   <a href="https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior">https://w3c.github.io/webappsec-csp/#source-list-allows-all-inline-behavior</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-list-allows-all-inline-behavior">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-source-list-allows-all-inline-behavior①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-content-security-policy-object">
   <a href="https://w3c.github.io/webappsec-csp/#content-security-policy-object">https://w3c.github.io/webappsec-csp/#content-security-policy-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-content-security-policy-object">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-content-security-policy-object①">3.1.2. Policy Intersection</a> <a href="#ref-for-content-security-policy-object②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-header-content-security-policy">
   <a href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">https://w3c.github.io/webappsec-csp/#header-content-security-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-header-content-security-policy">1. Introduction</a>
    <li><a href="#ref-for-header-content-security-policy①">1.1. Examples</a> <a href="#ref-for-header-content-security-policy②">(2)</a> <a href="#ref-for-header-content-security-policy③">(3)</a> <a href="#ref-for-header-content-security-policy④">(4)</a>
    <li><a href="#ref-for-header-content-security-policy⑤">2. Framework</a> <a href="#ref-for-header-content-security-policy⑥">(2)</a>
    <li><a href="#ref-for-header-content-security-policy⑦">3. Implicit Policy Acceptance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-csp-list">
   <a href="https://w3c.github.io/webappsec-csp/#csp-list">https://w3c.github.io/webappsec-csp/#csp-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-csp-list">3. Implicit Policy Acceptance</a> <a href="#ref-for-csp-list①">(2)</a>
    <li><a href="#ref-for-csp-list②">3.1.1. CSP List intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-policy-directive-set">
   <a href="https://w3c.github.io/webappsec-csp/#policy-directive-set">https://w3c.github.io/webappsec-csp/#policy-directive-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-directive-set">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-policy-directive-set①">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-policy-directive-set②">3.1.2. Policy Intersection</a> <a href="#ref-for-policy-directive-set③">(2)</a> <a href="#ref-for-policy-directive-set④">(3)</a> <a href="#ref-for-policy-directive-set⑤">(4)</a> <a href="#ref-for-policy-directive-set⑥">(5)</a> <a href="#ref-for-policy-directive-set⑦">(6)</a>
    <li><a href="#ref-for-policy-directive-set⑧">3.1.4.1. Effective Directive Value</a> <a href="#ref-for-policy-directive-set⑨">(2)</a> <a href="#ref-for-policy-directive-set①⓪">(3)</a> <a href="#ref-for-policy-directive-set①①">(4)</a> <a href="#ref-for-policy-directive-set①②">(5)</a> <a href="#ref-for-policy-directive-set①③">(6)</a>
    <li><a href="#ref-for-policy-directive-set①④">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-policy-directive-set①⑤">(2)</a>
    <li><a href="#ref-for-policy-directive-set①⑥">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directives">
   <a href="https://w3c.github.io/webappsec-csp/#directives">https://w3c.github.io/webappsec-csp/#directives</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directives">3.1.2. Policy Intersection</a> <a href="#ref-for-directives①">(2)</a> <a href="#ref-for-directives②">(3)</a>
    <li><a href="#ref-for-directives③">3.1.4.1. Effective Directive Value</a> <a href="#ref-for-directives④">(2)</a> <a href="#ref-for-directives⑤">(3)</a> <a href="#ref-for-directives⑥">(4)</a> <a href="#ref-for-directives⑦">(5)</a> <a href="#ref-for-directives⑧">(6)</a> <a href="#ref-for-directives⑨">(7)</a> <a href="#ref-for-directives①⓪">(8)</a> <a href="#ref-for-directives①①">(9)</a> <a href="#ref-for-directives①②">(10)</a> <a href="#ref-for-directives①③">(11)</a> <a href="#ref-for-directives①④">(12)</a>
    <li><a href="#ref-for-directives①⑤">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-policy-disposition">
   <a href="https://w3c.github.io/webappsec-csp/#policy-disposition">https://w3c.github.io/webappsec-csp/#policy-disposition</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-disposition">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-policy-disposition①">3.1.2. Policy Intersection</a> <a href="#ref-for-policy-disposition②">(2)</a>
    <li><a href="#ref-for-policy-disposition③">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-frame-ancestors">
   <a href="https://w3c.github.io/webappsec-csp/#frame-ancestors">https://w3c.github.io/webappsec-csp/#frame-ancestors</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frame-ancestors">5.1. Policy Enforcement</a>
    <li><a href="#ref-for-frame-ancestors①">5.2. Policy Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-hash-source">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">https://w3c.github.io/webappsec-csp/#grammardef-hash-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-hash-source">3. Implicit Policy Acceptance</a>
    <li><a href="#ref-for-grammardef-hash-source①">3.1.3. Source List Intersection</a> <a href="#ref-for-grammardef-hash-source②">(2)</a>
    <li><a href="#ref-for-grammardef-hash-source③">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-hash-source④">(2)</a>
    <li><a href="#ref-for-grammardef-hash-source⑤">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-hash-source⑥">(2)</a>
    <li><a href="#ref-for-grammardef-hash-source⑦">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-grammardef-hash-source⑧">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-grammardef-hash-source⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-host-part">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-host-part">https://w3c.github.io/webappsec-csp/#grammardef-host-part</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-host-part">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-host-part①">(2)</a>
    <li><a href="#ref-for-grammardef-host-part②">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-host-part③">(2)</a> <a href="#ref-for-grammardef-host-part④">(3)</a>
    <li><a href="#ref-for-grammardef-host-part⑤">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-host-part⑥">(2)</a> <a href="#ref-for-grammardef-host-part⑦">(3)</a>
    <li><a href="#ref-for-grammardef-host-part⑧">4.2.3. 
    Does source expression A subsume source expression B? </a> <a href="#ref-for-grammardef-host-part⑨">(2)</a> <a href="#ref-for-grammardef-host-part①⓪">(3)</a> <a href="#ref-for-grammardef-host-part①①">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-host-part-match">
   <a href="https://w3c.github.io/webappsec-csp/#host-part-match">https://w3c.github.io/webappsec-csp/#host-part-match</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-host-part-match">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-host-part-match①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-host-source">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-host-source">https://w3c.github.io/webappsec-csp/#grammardef-host-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-host-source">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-grammardef-host-source①">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-host-source②">(2)</a>
    <li><a href="#ref-for-grammardef-host-source③">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-host-source④">(2)</a> <a href="#ref-for-grammardef-host-source⑤">(3)</a>
    <li><a href="#ref-for-grammardef-host-source⑥">4.2.2. 
    Rewrite 'self' into a host-source expression for origin. </a>
    <li><a href="#ref-for-grammardef-host-source⑦">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-grammardef-host-source⑧">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-grammardef-host-source⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-keyword-source">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-keyword-source">https://w3c.github.io/webappsec-csp/#grammardef-keyword-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-keyword-source">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-grammardef-keyword-source①">3.1.4.2. Effective Source List</a>
    <li><a href="#ref-for-grammardef-keyword-source②">3.1.4.3. Source Expression Similarity</a>
    <li><a href="#ref-for-grammardef-keyword-source③">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-grammardef-keyword-source④">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-grammardef-keyword-source⑤">(2)</a> <a href="#ref-for-grammardef-keyword-source⑥">(3)</a> <a href="#ref-for-grammardef-keyword-source⑦">(4)</a> <a href="#ref-for-grammardef-keyword-source⑧">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directive-name">
   <a href="https://w3c.github.io/webappsec-csp/#directive-name">https://w3c.github.io/webappsec-csp/#directive-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-name">3.1.2. Policy Intersection</a> <a href="#ref-for-directive-name①">(2)</a> <a href="#ref-for-directive-name②">(3)</a> <a href="#ref-for-directive-name③">(4)</a> <a href="#ref-for-directive-name④">(5)</a>
    <li><a href="#ref-for-directive-name⑤">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-directive-name⑥">3.1.4.1. Effective Directive Value</a> <a href="#ref-for-directive-name⑦">(2)</a> <a href="#ref-for-directive-name⑧">(3)</a> <a href="#ref-for-directive-name⑨">(4)</a> <a href="#ref-for-directive-name①⓪">(5)</a> <a href="#ref-for-directive-name①①">(6)</a>
    <li><a href="#ref-for-directive-name①②">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-directive-name①③">(2)</a> <a href="#ref-for-directive-name①④">(3)</a> <a href="#ref-for-directive-name①⑤">(4)</a> <a href="#ref-for-directive-name①⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-nonce-source">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-nonce-source">https://w3c.github.io/webappsec-csp/#grammardef-nonce-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-nonce-source">3.1.3. Source List Intersection</a> <a href="#ref-for-grammardef-nonce-source①">(2)</a>
    <li><a href="#ref-for-grammardef-nonce-source②">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-nonce-source③">(2)</a>
    <li><a href="#ref-for-grammardef-nonce-source④">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-nonce-source⑤">(2)</a>
    <li><a href="#ref-for-grammardef-nonce-source⑥">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-grammardef-nonce-source⑦">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-serialized-policy">
   <a href="https://w3c.github.io/webappsec-csp/#parse-serialized-policy">https://w3c.github.io/webappsec-csp/#parse-serialized-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-serialized-policy">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-parse-serialized-policy①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-path-part">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-path-part">https://w3c.github.io/webappsec-csp/#grammardef-path-part</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-path-part">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-path-part①">(2)</a>
    <li><a href="#ref-for-grammardef-path-part②">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-path-part③">(2)</a>
    <li><a href="#ref-for-grammardef-path-part④">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-path-part⑤">(2)</a> <a href="#ref-for-grammardef-path-part⑥">(3)</a>
    <li><a href="#ref-for-grammardef-path-part⑦">4.2.3. 
    Does source expression A subsume source expression B? </a> <a href="#ref-for-grammardef-path-part⑧">(2)</a> <a href="#ref-for-grammardef-path-part⑨">(3)</a> <a href="#ref-for-grammardef-path-part①⓪">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-path-part-match">
   <a href="https://w3c.github.io/webappsec-csp/#path-part-match">https://w3c.github.io/webappsec-csp/#path-part-match</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-path-part-match">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-path-part-match①">(2)</a>
    <li><a href="#ref-for-path-part-match②">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-violation-policy">
   <a href="https://w3c.github.io/webappsec-csp/#violation-policy">https://w3c.github.io/webappsec-csp/#violation-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-violation-policy">3. Implicit Policy Acceptance</a> <a href="#ref-for-violation-policy①">(2)</a> <a href="#ref-for-violation-policy②">(3)</a>
    <li><a href="#ref-for-violation-policy③">3.1.4.1. Effective Directive Value</a>
    <li><a href="#ref-for-violation-policy④">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-violation-policy⑤">(2)</a> <a href="#ref-for-violation-policy⑥">(3)</a> <a href="#ref-for-violation-policy⑦">(4)</a>
    <li><a href="#ref-for-violation-policy⑧">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a> <a href="#ref-for-violation-policy⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-port-part">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-port-part">https://w3c.github.io/webappsec-csp/#grammardef-port-part</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-port-part">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-port-part①">(2)</a>
    <li><a href="#ref-for-grammardef-port-part②">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-port-part③">(2)</a> <a href="#ref-for-grammardef-port-part④">(3)</a>
    <li><a href="#ref-for-grammardef-port-part⑤">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-port-part⑥">(2)</a> <a href="#ref-for-grammardef-port-part⑦">(3)</a>
    <li><a href="#ref-for-grammardef-port-part⑧">4.2.3. 
    Does source expression A subsume source expression B? </a> <a href="#ref-for-grammardef-port-part⑨">(2)</a> <a href="#ref-for-grammardef-port-part①⓪">(3)</a> <a href="#ref-for-grammardef-port-part①①">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-port-part-match">
   <a href="https://w3c.github.io/webappsec-csp/#port-part-match">https://w3c.github.io/webappsec-csp/#port-part-match</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-port-part-match">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-port-part-match①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-report-to">
   <a href="https://w3c.github.io/webappsec-csp/#report-to">https://w3c.github.io/webappsec-csp/#report-to</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-report-to">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-report-uri">
   <a href="https://w3c.github.io/webappsec-csp/#report-uri">https://w3c.github.io/webappsec-csp/#report-uri</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-report-uri">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-scheme-part">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-part">https://w3c.github.io/webappsec-csp/#grammardef-scheme-part</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-scheme-part">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-grammardef-scheme-part①">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-scheme-part②">(2)</a>
    <li><a href="#ref-for-grammardef-scheme-part③">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-scheme-part④">(2)</a> <a href="#ref-for-grammardef-scheme-part⑤">(3)</a>
    <li><a href="#ref-for-grammardef-scheme-part⑥">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-scheme-part⑦">(2)</a> <a href="#ref-for-grammardef-scheme-part⑧">(3)</a>
    <li><a href="#ref-for-grammardef-scheme-part⑨">4.2.3. 
    Does source expression A subsume source expression B? </a> <a href="#ref-for-grammardef-scheme-part①⓪">(2)</a> <a href="#ref-for-grammardef-scheme-part①①">(3)</a> <a href="#ref-for-grammardef-scheme-part①②">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-scheme-part-match">
   <a href="https://w3c.github.io/webappsec-csp/#scheme-part-match">https://w3c.github.io/webappsec-csp/#scheme-part-match</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheme-part-match">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-scheme-part-match①">(2)</a> <a href="#ref-for-scheme-part-match②">(3)</a>
    <li><a href="#ref-for-scheme-part-match③">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-scheme-source">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-scheme-source">https://w3c.github.io/webappsec-csp/#grammardef-scheme-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-scheme-source">3.1.3. Source List Intersection</a> <a href="#ref-for-grammardef-scheme-source①">(2)</a> <a href="#ref-for-grammardef-scheme-source②">(3)</a> <a href="#ref-for-grammardef-scheme-source③">(4)</a>
    <li><a href="#ref-for-grammardef-scheme-source④">3.1.4.2. Effective Source List</a> <a href="#ref-for-grammardef-scheme-source⑤">(2)</a>
    <li><a href="#ref-for-grammardef-scheme-source⑥">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-grammardef-scheme-source⑦">(2)</a>
    <li><a href="#ref-for-grammardef-scheme-source⑧">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-grammardef-scheme-source⑨">(2)</a> <a href="#ref-for-grammardef-scheme-source①⓪">(3)</a> <a href="#ref-for-grammardef-scheme-source①①">(4)</a> <a href="#ref-for-grammardef-scheme-source①②">(5)</a>
    <li><a href="#ref-for-grammardef-scheme-source①③">4.2.3. 
    Does source expression A subsume source expression B? </a> <a href="#ref-for-grammardef-scheme-source①④">(2)</a> <a href="#ref-for-grammardef-scheme-source①⑤">(3)</a>
    <li><a href="#ref-for-grammardef-scheme-source①⑥">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-grammardef-scheme-source①⑦">(2)</a> <a href="#ref-for-grammardef-scheme-source①⑧">(3)</a> <a href="#ref-for-grammardef-scheme-source①⑨">(4)</a> <a href="#ref-for-grammardef-scheme-source②⓪">(5)</a> <a href="#ref-for-grammardef-scheme-source②①">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-serialized-csp">
   <a href="https://w3c.github.io/webappsec-csp/#serialized-csp">https://w3c.github.io/webappsec-csp/#serialized-csp</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serialized-csp">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-serialized-csp①">2.4.1. Browsing Context’s Required CSP</a>
    <li><a href="#ref-for-serialized-csp②">3.1.1. CSP List intersection</a> <a href="#ref-for-serialized-csp③">(2)</a>
    <li><a href="#ref-for-serialized-csp④">3.1.2. Policy Intersection</a> <a href="#ref-for-serialized-csp⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-serialized-policy">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy">https://w3c.github.io/webappsec-csp/#grammardef-serialized-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-serialized-policy">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-grammardef-serialized-policy①">2.2. The Sec-Required-CSP HTTP Request Header</a> <a href="#ref-for-grammardef-serialized-policy②">(2)</a> <a href="#ref-for-grammardef-serialized-policy③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-expression">
   <a href="https://w3c.github.io/webappsec-csp/#source-expression">https://w3c.github.io/webappsec-csp/#source-expression</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-source-expression①">(2)</a> <a href="#ref-for-source-expression②">(3)</a> <a href="#ref-for-source-expression③">(4)</a> <a href="#ref-for-source-expression④">(5)</a> <a href="#ref-for-source-expression⑤">(6)</a>
    <li><a href="#ref-for-source-expression⑥">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a>
    <li><a href="#ref-for-source-expression⑦">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-source-expression⑧">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-lists">
   <a href="https://w3c.github.io/webappsec-csp/#source-lists">https://w3c.github.io/webappsec-csp/#source-lists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-lists">3.1.2. Policy Intersection</a> <a href="#ref-for-source-lists①">(2)</a> <a href="#ref-for-source-lists②">(3)</a>
    <li><a href="#ref-for-source-lists③">3.1.3. Source List Intersection</a> <a href="#ref-for-source-lists④">(2)</a> <a href="#ref-for-source-lists⑤">(3)</a> <a href="#ref-for-source-lists⑥">(4)</a>
    <li><a href="#ref-for-source-lists⑦">3.1.4.2. Effective Source List</a> <a href="#ref-for-source-lists⑧">(2)</a>
    <li><a href="#ref-for-source-lists⑨">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-source-lists①⓪">(2)</a> <a href="#ref-for-source-lists①①">(3)</a> <a href="#ref-for-source-lists①②">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directive-value">
   <a href="https://w3c.github.io/webappsec-csp/#directive-value">https://w3c.github.io/webappsec-csp/#directive-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-value">3.1.2. Policy Intersection</a> <a href="#ref-for-directive-value①">(2)</a> <a href="#ref-for-directive-value②">(3)</a> <a href="#ref-for-directive-value③">(4)</a> <a href="#ref-for-directive-value④">(5)</a> <a href="#ref-for-directive-value⑤">(6)</a> <a href="#ref-for-directive-value⑥">(7)</a> <a href="#ref-for-directive-value⑦">(8)</a> <a href="#ref-for-directive-value⑧">(9)</a> <a href="#ref-for-directive-value⑨">(10)</a>
    <li><a href="#ref-for-directive-value①⓪">3.1.4.1. Effective Directive Value</a> <a href="#ref-for-directive-value①①">(2)</a> <a href="#ref-for-directive-value①②">(3)</a> <a href="#ref-for-directive-value①③">(4)</a> <a href="#ref-for-directive-value①④">(5)</a> <a href="#ref-for-directive-value①⑤">(6)</a> <a href="#ref-for-directive-value①⑥">(7)</a>
    <li><a href="#ref-for-directive-value①⑦">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mult-zero-plus">
   <a href="https://drafts.csswg.org/css-values-4/#mult-zero-plus">https://drafts.csswg.org/css-values-4/#mult-zero-plus</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mult-zero-plus">3.1.4.2. Effective Source List</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element">
   <a href="https://dom.spec.whatwg.org/#concept-element">https://dom.spec.whatwg.org/#concept-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-document">
   <a href="https://dom.spec.whatwg.org/#concept-node-document">https://dom.spec.whatwg.org/#concept-node-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-document">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-concept-node-document①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-reflect">
   <a href="https://dom.spec.whatwg.org/#concept-reflect">https://dom.spec.whatwg.org/#concept-reflect</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-reflect">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-utf-8-encode">
   <a href="https://encoding.spec.whatwg.org/#utf-8-encode">https://encoding.spec.whatwg.org/#utf-8-encode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-utf-8-encode">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-append">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-append">https://fetch.spec.whatwg.org/#concept-header-list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-append">2.2. The Sec-Required-CSP HTTP Request Header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-client">
   <a href="https://fetch.spec.whatwg.org/#concept-request-client">https://fetch.spec.whatwg.org/#concept-request-client</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-client">2.2. The Sec-Required-CSP HTTP Request Header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-csp-list">
   <a href="https://fetch.spec.whatwg.org/#concept-response-csp-list">https://fetch.spec.whatwg.org/#concept-response-csp-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-csp-list">4.1. 
    Is response to request blocked by context’s required CSP? </a> <a href="#ref-for-concept-response-csp-list①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-header-list">
   <a href="https://fetch.spec.whatwg.org/#concept-response-header-list">https://fetch.spec.whatwg.org/#concept-response-header-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-header-list">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-local-scheme">
   <a href="https://fetch.spec.whatwg.org/#local-scheme">https://fetch.spec.whatwg.org/#local-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-local-scheme">4.2. 
    Does response allow blanket enforcement of policy from request? </a> <a href="#ref-for-local-scheme①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigation-request">
   <a href="https://fetch.spec.whatwg.org/#navigation-request">https://fetch.spec.whatwg.org/#navigation-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-request">2. Framework</a>
    <li><a href="#ref-for-navigation-request①">2.2. The Sec-Required-CSP HTTP Request Header</a> <a href="#ref-for-navigation-request②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-origin">
   <a href="https://fetch.spec.whatwg.org/#concept-request-origin">https://fetch.spec.whatwg.org/#concept-request-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-origin">4.1. 
    Is response to request blocked by context’s required CSP? </a>
    <li><a href="#ref-for-concept-request-origin①">4.2. 
    Does response allow blanket enforcement of policy from request? </a> <a href="#ref-for-concept-request-origin②">(2)</a>
    <li><a href="#ref-for-concept-request-origin③">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-concept-request-origin④">(2)</a> <a href="#ref-for-concept-request-origin⑤">(3)</a>
    <li><a href="#ref-for-concept-request-origin⑥">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-concept-request-origin⑦">(2)</a> <a href="#ref-for-concept-request-origin⑧">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-origin">
   <a href="https://fetch.spec.whatwg.org/#http-origin">https://fetch.spec.whatwg.org/#http-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-origin">2.3. The Allow-CSP-From HTTP Response Header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-concept-request①">4.1. 
    Is response to request blocked by context’s required CSP? </a>
    <li><a href="#ref-for-concept-request②">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response">
   <a href="https://fetch.spec.whatwg.org/#concept-response">https://fetch.spec.whatwg.org/#concept-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response">4.1. 
    Is response to request blocked by context’s required CSP? </a>
    <li><a href="#ref-for-concept-response①">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-url">
   <a href="https://fetch.spec.whatwg.org/#concept-response-url">https://fetch.spec.whatwg.org/#concept-response-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-url">4.1. 
    Is response to request blocked by context’s required CSP? </a>
    <li><a href="#ref-for-concept-response-url①">4.2. 
    Does response allow blanket enforcement of policy from request? </a> <a href="#ref-for-concept-response-url②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-new-header-syntax">
   <a href="https://fetch.spec.whatwg.org/#http-new-header-syntax">https://fetch.spec.whatwg.org/#http-new-header-syntax</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-new-header-syntax">2.3. The Allow-CSP-From HTTP Response Header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-cereactions">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cereactions">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmliframeelement">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmliframeelement">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-document">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">https://html.spec.whatwg.org/multipage/browsers.html#active-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-document">2.4.1. Browsing Context’s Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-serialisation-of-an-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin">https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-serialisation-of-an-origin">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
    <li><a href="#ref-for-ascii-serialisation-of-an-origin①">4.2.2. 
    Rewrite 'self' into a host-source expression for origin. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-bc">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-bc">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-concept-document-bc①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context-container">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-container">2.4.1. Browsing Context’s Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-attributes">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes">https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-attributes">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-concept-element-attributes①">(2)</a> <a href="#ref-for-concept-element-attributes②">(3)</a>
    <li><a href="#ref-for-concept-element-attributes③">2.4.1. Browsing Context’s Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-iframe-element">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-iframe-element">1. Introduction</a> <a href="#ref-for-the-iframe-element①">(2)</a>
    <li><a href="#ref-for-the-iframe-element②">1.1. Examples</a>
    <li><a href="#ref-for-the-iframe-element③">2. Framework</a> <a href="#ref-for-the-iframe-element④">(2)</a>
    <li><a href="#ref-for-the-iframe-element⑤">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-the-iframe-element⑥">(2)</a>
    <li><a href="#ref-for-the-iframe-element⑦">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-the-iframe-element⑧">2.4. Integration with HTML</a>
    <li><a href="#ref-for-the-iframe-element⑨">6.1. 
    Requiring 'self' </a> <a href="#ref-for-the-iframe-element①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigate">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigate">2. Framework</a>
    <li><a href="#ref-for-navigate①">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-navigate②">2.4. Integration with HTML</a>
    <li><a href="#ref-for-navigate③">2.4.1. Browsing Context’s Required CSP</a> <a href="#ref-for-navigate④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nested-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nested-browsing-context">2. Framework</a>
    <li><a href="#ref-for-nested-browsing-context①">2.4.1. Browsing Context’s Required CSP</a>
    <li><a href="#ref-for-nested-browsing-context②">4.1. 
    Is response to request blocked by context’s required CSP? </a> <a href="#ref-for-nested-browsing-context③">(2)</a>
    <li><a href="#ref-for-nested-browsing-context④">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin-opaque">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-opaque">https://html.spec.whatwg.org/multipage/origin.html#concept-origin-opaque</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin-opaque">4.2.2. 
    Rewrite 'self' into a host-source expression for origin. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-concept-origin①">3.1.2. Policy Intersection</a>
    <li><a href="#ref-for-concept-origin②">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-concept-origin③">3.1.4.2. Effective Source List</a>
    <li><a href="#ref-for-concept-origin④">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a> <a href="#ref-for-concept-origin⑤">(2)</a> <a href="#ref-for-concept-origin⑥">(3)</a>
    <li><a href="#ref-for-concept-origin⑦">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parent-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parent-browsing-context">2.4.1. Browsing Context’s Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-fetch">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-fetch">2.4. Integration with HTML</a> <a href="#ref-for-process-a-navigate-fetch①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-response">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-response">2.4. Integration with HTML</a> <a href="#ref-for-process-a-navigate-response①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin-scheme">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-scheme">https://html.spec.whatwg.org/multipage/origin.html#concept-origin-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin-scheme">3.1.4.2. Effective Source List</a>
    <li><a href="#ref-for-concept-origin-scheme①">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-concept-origin-scheme②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context">https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-browsing-context">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">3.1.2. Policy Intersection</a> <a href="#ref-for-set-append①">(2)</a> <a href="#ref-for-set-append②">(3)</a> <a href="#ref-for-set-append③">(4)</a> <a href="#ref-for-set-append④">(5)</a>
    <li><a href="#ref-for-set-append⑤">3.1.3. Source List Intersection</a> <a href="#ref-for-set-append⑥">(2)</a> <a href="#ref-for-set-append⑦">(3)</a> <a href="#ref-for-set-append⑧">(4)</a> <a href="#ref-for-set-append⑨">(5)</a>
    <li><a href="#ref-for-set-append①⓪">3.1.4.2. Effective Source List</a> <a href="#ref-for-set-append①①">(2)</a> <a href="#ref-for-set-append①②">(3)</a> <a href="#ref-for-set-append①③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-case-insensitive">
   <a href="https://infra.spec.whatwg.org/#ascii-case-insensitive">https://infra.spec.whatwg.org/#ascii-case-insensitive</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-case-insensitive">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-ascii-case-insensitive①">3.1.4.3. Source Expression Similarity</a>
    <li><a href="#ref-for-ascii-case-insensitive②">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-contain">
   <a href="https://infra.spec.whatwg.org/#list-contain">https://infra.spec.whatwg.org/#list-contain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-contain">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-list-contain①">3.1.3. Source List Intersection</a> <a href="#ref-for-list-contain②">(2)</a> <a href="#ref-for-list-contain③">(3)</a> <a href="#ref-for-list-contain④">(4)</a>
    <li><a href="#ref-for-list-contain⑤">3.1.4.1. Effective Directive Value</a> <a href="#ref-for-list-contain⑥">(2)</a> <a href="#ref-for-list-contain⑦">(3)</a> <a href="#ref-for-list-contain⑧">(4)</a> <a href="#ref-for-list-contain⑨">(5)</a> <a href="#ref-for-list-contain①⓪">(6)</a>
    <li><a href="#ref-for-list-contain①①">3.1.4.2. Effective Source List</a> <a href="#ref-for-list-contain①②">(2)</a>
    <li><a href="#ref-for-list-contain①③">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-iteration-continue">
   <a href="https://infra.spec.whatwg.org/#iteration-continue">https://infra.spec.whatwg.org/#iteration-continue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iteration-continue">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-iteration-continue①">3.1.2. Policy Intersection</a> <a href="#ref-for-iteration-continue②">(2)</a> <a href="#ref-for-iteration-continue③">(3)</a> <a href="#ref-for-iteration-continue④">(4)</a>
    <li><a href="#ref-for-iteration-continue⑤">3.1.3. Source List Intersection</a> <a href="#ref-for-iteration-continue⑥">(2)</a> <a href="#ref-for-iteration-continue⑦">(3)</a>
    <li><a href="#ref-for-iteration-continue⑧">3.1.4.2. Effective Source List</a> <a href="#ref-for-iteration-continue⑨">(2)</a> <a href="#ref-for-iteration-continue①⓪">(3)</a> <a href="#ref-for-iteration-continue①①">(4)</a>
    <li><a href="#ref-for-iteration-continue①②">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-iteration-continue①③">(2)</a> <a href="#ref-for-iteration-continue①④">(3)</a>
    <li><a href="#ref-for-iteration-continue①⑤">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-iteration-continue①⑥">(2)</a> <a href="#ref-for-iteration-continue①⑦">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-is-empty">
   <a href="https://infra.spec.whatwg.org/#list-is-empty">https://infra.spec.whatwg.org/#list-is-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-is-empty">3.1.2. Policy Intersection</a> <a href="#ref-for-list-is-empty①">(2)</a>
    <li><a href="#ref-for-list-is-empty②">3.1.4.2. Effective Source List</a> <a href="#ref-for-list-is-empty③">(2)</a>
    <li><a href="#ref-for-list-is-empty④">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a>
    <li><a href="#ref-for-list-is-empty⑤">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a> <a href="#ref-for-list-is-empty⑥">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">3.1.2. Policy Intersection</a>
    <li><a href="#ref-for-ordered-set①">3.1.3. Source List Intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string">
   <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-string①">3.1.4.1. Effective Directive Value</a>
    <li><a href="#ref-for-string②">3.1.4.2. Effective Source List</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">4.1. 
    Is response to request blocked by context’s required CSP? </a>
    <li><a href="#ref-for-concept-url-origin①">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-grammardef-none">'none'</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-self">'self'</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-strict-dynamic">'strict-dynamic'</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-unsafe-inline">'unsafe-inline'</span>
     <li><span class="dfn-paneled" id="term-for-source-list-allows-all-inline-behavior">allows all inline behavior</span>
     <li><span class="dfn-paneled" id="term-for-content-security-policy-object">content security policy object</span>
     <li><span class="dfn-paneled" id="term-for-header-content-security-policy">content-security-policy</span>
     <li><span class="dfn-paneled" id="term-for-csp-list">csp list</span>
     <li><span class="dfn-paneled" id="term-for-policy-directive-set">directive set</span>
     <li><span class="dfn-paneled" id="term-for-directives">directives</span>
     <li><span class="dfn-paneled" id="term-for-policy-disposition">disposition</span>
     <li><span class="dfn-paneled" id="term-for-frame-ancestors">frame-ancestors</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-hash-source">hash-source</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-host-part">host-part</span>
     <li><span class="dfn-paneled" id="term-for-host-part-match">host-part match</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-host-source">host-source</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-keyword-source">keyword-source</span>
     <li><span class="dfn-paneled" id="term-for-directive-name">name</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-nonce-source">nonce-source</span>
     <li><span class="dfn-paneled" id="term-for-parse-serialized-policy">parse a serialized csp as disposition</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-path-part">path-part</span>
     <li><span class="dfn-paneled" id="term-for-path-part-match">path-part match</span>
     <li><span class="dfn-paneled" id="term-for-violation-policy">policy</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-port-part">port-part</span>
     <li><span class="dfn-paneled" id="term-for-port-part-match">port-part match</span>
     <li><span class="dfn-paneled" id="term-for-report-to">report-to</span>
     <li><span class="dfn-paneled" id="term-for-report-uri">report-uri</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-scheme-part">scheme-part</span>
     <li><span class="dfn-paneled" id="term-for-scheme-part-match">scheme-part match</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-scheme-source">scheme-source</span>
     <li><span class="dfn-paneled" id="term-for-serialized-csp">serialized csp</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-serialized-policy">serialized-policy</span>
     <li><span class="dfn-paneled" id="term-for-source-expression">source expression</span>
     <li><span class="dfn-paneled" id="term-for-source-lists">source lists</span>
     <li><span class="dfn-paneled" id="term-for-directive-value">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-mult-zero-plus">*</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-element">element</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-document">node document</span>
     <li><span class="dfn-paneled" id="term-for-concept-reflect">reflect</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-utf-8-encode">utf-8 encode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-append">append</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-client">client</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-csp-list">csp list</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-header-list">header list <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-local-scheme">local scheme</span>
     <li><span class="dfn-paneled" id="term-for-navigation-request">navigation request</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-http-origin">origin-or-null</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-response">response</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-url">url</span>
     <li><span class="dfn-paneled" id="term-for-http-new-header-syntax">wildcard</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-cereactions">CEReactions</span>
     <li><span class="dfn-paneled" id="term-for-htmliframeelement">HTMLIFrameElement</span>
     <li><span class="dfn-paneled" id="term-for-active-document">active document</span>
     <li><span class="dfn-paneled" id="term-for-ascii-serialisation-of-an-origin">ascii serialization of an origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-bc">browsing context <small>(for Document)</small></span>
     <li><span class="dfn-paneled" id="term-for-browsing-context-container">browsing context container</span>
     <li><span class="dfn-paneled" id="term-for-concept-element-attributes">content attributes</span>
     <li><span class="dfn-paneled" id="term-for-the-iframe-element">iframe</span>
     <li><span class="dfn-paneled" id="term-for-navigate">navigate</span>
     <li><span class="dfn-paneled" id="term-for-nested-browsing-context">nested browsing context</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin-opaque">opaque origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-parent-browsing-context">parent browsing context</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-fetch">process a navigate fetch</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-response">process a navigate response</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin-scheme">scheme</span>
     <li><span class="dfn-paneled" id="term-for-source-browsing-context">source browsing context</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-set-append">append</span>
     <li><span class="dfn-paneled" id="term-for-ascii-case-insensitive">ascii case-insensitive</span>
     <li><span class="dfn-paneled" id="term-for-list-contain">contain</span>
     <li><span class="dfn-paneled" id="term-for-iteration-continue">continue</span>
     <li><span class="dfn-paneled" id="term-for-list-is-empty">is empty</span>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">set</span>
     <li><span class="dfn-paneled" id="term-for-string">string</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme">scheme</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West. <a href="https://www.w3.org/TR/CSP3/">Content Security Policy Level 3</a>. 19 March 2021. WD. URL: <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-4/">CSS Values and Units Module Level 4</a>. 11 November 2020. WD. URL: <a href="https://www.w3.org/TR/css-values-4/">https://www.w3.org/TR/css-values-4/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/">Encoding Standard</a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://datatracker.ietf.org/doc/html/rfc3864">Registration Procedures for Message Header Fields</a>. September 2004. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc3864">https://datatracker.ietf.org/doc/html/rfc3864</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://datatracker.ietf.org/doc/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://datatracker.ietf.org/doc/html/rfc5234">https://datatracker.ietf.org/doc/html/rfc5234</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement"><c- g>HTMLIFrameElement</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString" href="#dom-htmliframeelement-csp"><code><c- g>csp</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Upstream this to all the HTMLs.<a href="#issue-2a91d948"> ↵ </a></div>
   <div class="issue"> Upstream this to WHATWG’s HTML.<a href="#issue-fdc1da1f"> ↵ </a></div>
   <div class="issue"> W3C’s HTML’s navigation algorithm is wildly divergent from WHATWG’s at
  this point. Upstream something to that document once things are reconciled. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-4457804d"> ↵ </a></div>
   <div class="issue"> Upstream this to WHATWG’s HTML.<a href="#issue-fdc1da1f①"> ↵ </a></div>
   <div class="issue"> W3C’s HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response">process a navigate response</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-ed7a45a9"> ↵ </a></div>
   <div class="issue"> Upstream this to WHATWG’s HTML.<a href="#issue-fdc1da1f②"> ↵ </a></div>
   <div class="issue"> W3C’s HTML is not based on Fetch, and does not have
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch">process a navigate fetch</a> algorithm into which to hook. <a href="https://github.com/w3c/html/issues/584">&lt;https://github.com/w3c/html/issues/584></a><a href="#issue-df6fcac2"> ↵ </a></div>
   <div class="issue"> Upstream a hook to HTML.<a href="#issue-b71d345b"> ↵ </a></div>
   <div class="issue"> We shouldn’t make the reader do this exercise.<a href="#issue-f2ff64e0"> ↵ </a></div>
   <div class="issue"> We need to extend this definition to handle things that are not source lists.
  Also, we should be more precise about this, perhaps by defining a term like "source list
  directive" that we could check against <var>directive name</var>.<a href="#issue-5b9d5f29"> ↵ </a></div>
   <div class="issue"> Move the remaining intersection algorithms into this section.<a href="#issue-b43dcb1b"> ↵ </a></div>
   <div class="issue"> Move all the subsumption algorithms into this section.<a href="#issue-94e5cca5"> ↵ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a"> ↵ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a①"> ↵ </a></div>
   <div class="issue"> TODO.<a href="#issue-95f2d23a②"> ↵ </a></div>
   <div class="issue"> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.<a href="#issue-56722a75"> ↵ </a></div>
   <div class="issue"> Spell out the concerns Mario raised in the thread around <a href="https://twitter.com/0x6D6172696F/status/810066803653308416">https://twitter.com/0x6D6172696F/status/810066803653308416</a>.<a href="#issue-56722a75①"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="element-attrdef-iframe-csp">
   <b><a href="#element-attrdef-iframe-csp">#element-attrdef-iframe-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-iframe-csp">1.1. Examples</a> <a href="#ref-for-element-attrdef-iframe-csp①">(2)</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp②">2. Framework</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp③">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-element-attrdef-iframe-csp④">(2)</a> <a href="#ref-for-element-attrdef-iframe-csp⑤">(3)</a> <a href="#ref-for-element-attrdef-iframe-csp⑥">(4)</a> <a href="#ref-for-element-attrdef-iframe-csp⑦">(5)</a> <a href="#ref-for-element-attrdef-iframe-csp⑧">(6)</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp⑨">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp①⓪">2.4. Integration with HTML</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp①①">2.4.1. Browsing Context’s Required CSP</a>
    <li><a href="#ref-for-element-attrdef-iframe-csp①②">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="iframe-csp-valid-attribute-value">
   <b><a href="#iframe-csp-valid-attribute-value">#iframe-csp-valid-attribute-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iframe-csp-valid-attribute-value">2.4.1. Browsing Context’s Required CSP</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmliframeelement-csp">
   <b><a href="#dom-htmliframeelement-csp">#dom-htmliframeelement-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmliframeelement-csp">2.1. &lt;iframe>'s csp attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="http-headerdef-sec-required-csp">
   <b><a href="#http-headerdef-sec-required-csp">#http-headerdef-sec-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-headerdef-sec-required-csp">1. Introduction</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp①">1.1. Examples</a> <a href="#ref-for-http-headerdef-sec-required-csp②">(2)</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp③">2. Framework</a> <a href="#ref-for-http-headerdef-sec-required-csp④">(2)</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp⑤">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp⑥">2.4. Integration with HTML</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp⑦">5.3. Data Exfiltration</a>
    <li><a href="#ref-for-http-headerdef-sec-required-csp⑧">7. IANA Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-set-the-sec-required-csp-header">
   <b><a href="#abstract-opdef-set-the-sec-required-csp-header">#abstract-opdef-set-the-sec-required-csp-header</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-set-the-sec-required-csp-header">2.4. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="http-headerdef-allow-csp-from">
   <b><a href="#http-headerdef-allow-csp-from">#http-headerdef-allow-csp-from</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-headerdef-allow-csp-from">1. Introduction</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from①">1.1. Examples</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from②">2. Framework</a> <a href="#ref-for-http-headerdef-allow-csp-from③">(2)</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from④">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from⑤">3. Implicit Policy Acceptance</a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from⑥">4.2. 
    Does response allow blanket enforcement of policy from request? </a>
    <li><a href="#ref-for-http-headerdef-allow-csp-from⑦">7. IANA Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="browsing-context-required-csp">
   <b><a href="#browsing-context-required-csp">#browsing-context-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-required-csp">2.1. &lt;iframe>'s csp attribute</a> <a href="#ref-for-browsing-context-required-csp①">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp②">2.2. The Sec-Required-CSP HTTP Request Header</a>
    <li><a href="#ref-for-browsing-context-required-csp③">2.4. Integration with HTML</a> <a href="#ref-for-browsing-context-required-csp④">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp⑤">2.4.1. Browsing Context’s Required CSP</a> <a href="#ref-for-browsing-context-required-csp⑥">(2)</a> <a href="#ref-for-browsing-context-required-csp⑦">(3)</a> <a href="#ref-for-browsing-context-required-csp⑧">(4)</a>
    <li><a href="#ref-for-browsing-context-required-csp⑨">4.1. 
    Is response to request blocked by context’s required CSP? </a> <a href="#ref-for-browsing-context-required-csp①⓪">(2)</a>
    <li><a href="#ref-for-browsing-context-required-csp①①">6.1. 
    Requiring 'self' </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstract-opdef-set-the-required-csp">
   <b><a href="#abstract-opdef-set-the-required-csp">#abstract-opdef-set-the-required-csp</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-set-the-required-csp">2.4. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-subsume">
   <b><a href="#policy-subsume">#policy-subsume</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-subsume">3. Implicit Policy Acceptance</a> <a href="#ref-for-policy-subsume①">(2)</a>
    <li><a href="#ref-for-policy-subsume②">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-policy-subsume③">3.1.2. Policy Intersection</a>
    <li><a href="#ref-for-policy-subsume④">4.2.3. 
    Does source expression A subsume source expression B? </a>
    <li><a href="#ref-for-policy-subsume⑤">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-policy-subsume⑥">(2)</a> <a href="#ref-for-policy-subsume⑦">(3)</a> <a href="#ref-for-policy-subsume⑧">(4)</a> <a href="#ref-for-policy-subsume⑨">(5)</a>
    <li><a href="#ref-for-policy-subsume①⓪">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a>
    <li><a href="#ref-for-policy-subsume①①">4.3. 
    Does subsuming policy subsume policy list given their respective
    origins? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-subsumed-by">
   <b><a href="#policy-subsumed-by">#policy-subsumed-by</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-subsumed-by">2.1. &lt;iframe>'s csp attribute</a>
    <li><a href="#ref-for-policy-subsumed-by①">3.1.2. Policy Intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="csp-list-intersection">
   <b><a href="#csp-list-intersection">#csp-list-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-csp-list-intersection">3. Implicit Policy Acceptance</a> <a href="#ref-for-csp-list-intersection①">(2)</a>
    <li><a href="#ref-for-csp-list-intersection②">3.1.1. CSP List intersection</a>
    <li><a href="#ref-for-csp-list-intersection③">3.1.2. Policy Intersection</a> <a href="#ref-for-csp-list-intersection④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="content-security-policy-object-intersection">
   <b><a href="#content-security-policy-object-intersection">#content-security-policy-object-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-content-security-policy-object-intersection">3.1.1. CSP List intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-list-intersection">
   <b><a href="#source-list-intersection">#source-list-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-list-intersection">3.1.2. Policy Intersection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="effective-directive-value">
   <b><a href="#effective-directive-value">#effective-directive-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-effective-directive-value">3.1.2. Policy Intersection</a> <a href="#ref-for-effective-directive-value①">(2)</a>
    <li><a href="#ref-for-effective-directive-value②">4.2.5. 
    Does policy A subsume policy B given their respective
    origins? </a> <a href="#ref-for-effective-directive-value③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="effective-source-list">
   <b><a href="#effective-source-list">#effective-source-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-effective-source-list">3.1.3. Source List Intersection</a> <a href="#ref-for-effective-source-list①">(2)</a> <a href="#ref-for-effective-source-list②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-similar">
   <b><a href="#source-expression-similar">#source-expression-similar</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-similar">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-source-expression-similar①">(2)</a>
    <li><a href="#ref-for-source-expression-similar②">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-source-expression-similar③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-wildcard-host">
   <b><a href="#source-expression-wildcard-host">#source-expression-wildcard-host</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-wildcard-host">3.1.4.3. Source Expression Similarity</a> <a href="#ref-for-source-expression-wildcard-host①">(2)</a> <a href="#ref-for-source-expression-wildcard-host②">(3)</a>
    <li><a href="#ref-for-source-expression-wildcard-host③">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-wildcard-port">
   <b><a href="#source-expression-wildcard-port">#source-expression-wildcard-port</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-wildcard-port">3.1.4.3. Source Expression Similarity</a>
    <li><a href="#ref-for-source-expression-wildcard-port①">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="source-expression-intersection">
   <b><a href="#source-expression-intersection">#source-expression-intersection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-expression-intersection">3.1.3. Source List Intersection</a>
    <li><a href="#ref-for-source-expression-intersection①">4.2.1. 
    What is an intersection of two expressions matching
    scheme-source or host-source
    grammar A and B? </a> <a href="#ref-for-source-expression-intersection②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="directive-contains">
   <b><a href="#directive-contains">#directive-contains</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-contains">4.2.4. 
    Does source list A subsume source listB given their
    respective origins and directive names? </a> <a href="#ref-for-directive-contains①">(2)</a> <a href="#ref-for-directive-contains②">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-mdn-anno */

            document.body.addEventListener("click", (e) => {
                if(e.target.closest(".mdn-anno-btn")) {
                    e.target.closest(".mdn-anno").classList.toggle("wrapped");
                }
            });
            </script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>